<!--求知回答界面-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<link href="../../css/iconfont/iconfont.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="title" class="mui-title">物理</h1>
		</header>
		<div id="divContent" class="mui-content mui-hidden">
			<br />
			<div style="font-size: 16px;padding-left: 10px;">授课老师</div>
			<img id="teaHeadImg" style="padding-left: 10px;" src="../../image/clip.png" />
			<div style="border-color: green;height: auto;border-width:1px ;border-style:dashed;margin-right: 20px;margin-left: 30px;margin-top: -30px;">

				<div style="padding:5px 10px;">
					<p id="teaName" style="text-align: center;color: black;font-size: 14px;"></p><span id="teaInfo" style="text-align: center;color: black;font-size: 14px;">

					</span>
				</div>

			</div>
			<p style="background-color:lightgray;height: 1px;margin-top: 10px;"></p>
			<div>
				<div style="font-size: 16px;padding-left: 10px;">课程介绍</div>
				<p id="courseInfo" style="padding-left: 40px;color: black;font-size: 14px;padding-right: 10px;">
				</p>
			</div>
			<p style="background-color:lightgray;height: 1px;margin-top: 10px;"></p>
			<p id="history" style="color: black;font-size: 16px;padding-left: 10px;padding-right: 10px;">查看历史<span class="mui-icon iconfont icon-fanhui2" style="color:#b7b7b7;float: right;padding-top: 2px;"></span></p>
			<p style="background-color:lightgray;height: 1px;margin-top: 10px;"></p>
			<div align="center">
				<button id="focusBtn" class="mui-btn mui-btn-green btn-commit" style="background-color: #1db8F1;border-color:#1db8F1 ;border: 0;margin-left: 10px;margin-right: 10px;width: 90%;">关注</button>

			</div>

		</div>

		<!--mui.js-->
		<script src="../../js/mui.min.js"></script>
		<!--公共方法js-->
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/publicProtocol.js"></script>
		<script src="../../js/publicQiuzhiProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/publicMicroClass.js" type="text/javascript" charset="utf-8"></script>
	</body>
	<script type="text/javascript">
		var nodes = {
			title: document.getElementById("title"),
			teaHeadImg: document.getElementById("teaHeadImg"),
			teaName: document.getElementById("teaName"),
			teaInfo: document.getElementById("teaInfo"),
			courseInfo: document.getElementById("courseInfo"),
			history: document.getElementById("history"),
			focusBtn: document.getElementById("focusBtn"),
			focusFlag: 0,
		}
		var courseModel; //传值过来的课程model
		mui.plusReady(function() {
			var curPage = plus.webview.currentWebview();
			courseModel = curPage.data;
			getCourseInfo(courseModel.TabId);
			getCourseFocusByUser();
		})
		var getCourseInfo = function(courseId) {
			//4.获取课程信息
			//所需参数
			var comData = {
				courseId: courseId //课程ID
			};
			// 等待的对话框
			var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
			//4.获取课程信息
			postDataMCPro_getCourseInfoById(comData, wd, function(data) {
				wd.close();
				console.log('4.获取课程信息:' + JSON.stringify(data));
				if(data.RspCode == 0) {
					var courseInfo = data.RspData;
					createHtmlContent(courseInfo);
				} else {
					mui.toast(data.RspTxt);
				}
			});

		}
		var getCourseFocusByUser = function() {
			if(!events.getUtid()) {
				var focusecourse = window.myStorage.getItem(window.storageKeyName.FOCUSECOURSES);
				if(focusecourse) {
					for(var i in focusecourse) {
						if(focusecourse[i] == courseModel.TabId) {
							nodes.focusBtn.style.backgroundColor = 'lightgray'
							nodes.focusBtn.innerHTML = '已关注'
							nodes.focusFlag = 1;
						} else {
							nodes.focusBtn.style.backgroundColor = '#1db8F1'
							nodes.focusBtn.innerHTML = '关注'
							nodes.focusFlag = 0;
						}
					}
				}
				return;
			}
			var utid = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
			//5.获取是否已对某个课程关注
			//所需参数
			var comData = {
				userId: utid, //用户ID,登录用户
				courseId: courseModel.TabId //课程ID
			};
			//返回值：非0为已关注
			var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
			postDataMCPro_getCourseFocusByUser(comData, wd, function(data) {
				wd.close();
				console.log('5.获取是否已对某个课程关注:' + JSON.stringify(data));
				if(data.RspCode == 0) {
					if(data.RspData.Result == 1) {
						nodes.focusBtn.style.backgroundColor = 'lightgray'
						nodes.focusBtn.innerHTML = '已关注'
						nodes.focusFlag = 1;

					} else {
						nodes.focusBtn.style.backgroundColor = '#1db8F1'
						nodes.focusBtn.innerHTML = '关注'
						nodes.focusFlag = 0;
					}
				} else {
					mui.toast(data.RspTxt);
				}
			});
		}

		var createHtmlContent = function(courseInfo) {
			nodes.title.innerHTML = courseInfo.CourseName;
			//			nodes.teaHeadImg = courseInfo.teaHeadImg;
			nodes.teaName.innerHTML = courseInfo.TeacherName;
			nodes.teaInfo.innerHTML = courseInfo.TeacherNote;
			nodes.courseInfo.innerHTML = courseInfo.CourseNote;
			document.getElementById("divContent").className = 'mui-content'
		}
		events.addTap('history', function() {
			events.openNewWindowWithData('history-records.html', {})
		})
		events.addTap('focusBtn', function() {
			setCourseFocus(nodes.focusFlag)

		})
		var setCourseFocus = function(focusFlag) {
			if(!events.getUtid()) {
				events.toggleStorageArray(storageKeyName.FOCUSECOURSES, parseInt(courseModel.TabId), focusFlag);
				if(focusFlag == 0) {
					nodes.focusFlag = 1
					nodes.focusBtn.style.backgroundColor = 'lightgray'
					nodes.focusBtn.innerHTML = '已关注'

				} else {
					nodes.focusFlag = 0
					nodes.focusBtn.style.backgroundColor = '#1db8F1'
					nodes.focusBtn.innerHTML = '关注'
				}
				return;
			}
			var utid = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
			if(focusFlag == 0) {
				focusFlag = 1
			} else {
				focusFlag = 0
			}
			//6.设置对某个课程关注
			//所需参数
			var comData = {
				userId: utid, //用户ID,登录用户
				courseId: courseModel.TabId, //课程ID
				status: focusFlag //关注状态，0 不关注，1 关注
			};
			//返回值：1为正确
			var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
			postDataMCPro_setCourseFocus(comData, wd, function(data) {
				wd.close();
				console.log('6.设置对某个课程关注:' + JSON.stringify(data));
				if(data.RspCode == 0) {
					nodes.focusFlag = focusFlag;
					if(nodes.focusFlag == 1) {
						nodes.focusBtn.style.backgroundColor = 'lightgray'
						nodes.focusBtn.innerHTML = '已关注'

					} else {
						nodes.focusBtn.style.backgroundColor = '#1db8F1'
						nodes.focusBtn.innerHTML = '关注'
					}
				} else {
					mui.toast(data.RspTxt);
				}
			});
		}
	</script>

</html>