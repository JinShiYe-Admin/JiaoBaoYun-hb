<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<link href="../../css/iconfont/iconfont.css" rel="stylesheet" />
		<link href="../../css/qiuzhi/qiuzhi-questionSearch.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">搜索</h1>
		</header>
		<div class="mui-content" style="z-index:0">
			<div class="mui-scroll-wrapper mui-fullscreen" style="z-index:0">
				<div class="mui-scroll">
					<!--	<div class="search-form">
						<div class="mui-input-row mui-search">
							<input id="search-keyWord" type="search" class="mui-input-clear search-input" placeholder="请输入关键字搜索问题">
							<input id="search-btn" type="submit" class="search-btn" value="搜索"></input>
						</div>
					</div>-->
					<div class="search-form">
						<div class="mui-input-row mui-search">
							<input id="search-keyWord" type="search" class="mui-input-clear search-input" placeholder="请输入关键字搜索问题">
							<input id="search-btn" type="submit" class="search-btn" value="搜索"></input>
						</div>
					</div>
					<ul id="list-container" class="mui-table-view">
						<!--<li class="mui-table-view-cell">
							<p>现在能为父母的健康做点什么？</p>
							<p>摘要：先说说我家的情况，我爸爱抽烟，每天感觉能达到一包，我妈前几年腰间盘突出，现在好了，我家在农村，家里人收入可以约...</p>
							<p>57赞·3评论·关注</p>
						</li>
						<li class="mui-table-view-cell">
							<p>现在能为父母的健康做点什么？</p>
							<p>摘要：先说说我家的情况，我爸爱抽烟，每天感觉能达到一包，我妈前几年腰间盘突出，现在好了，我家在农村，家里人收入可以约...</p>
							<p>57赞·3评论·关注</p>
						</li>
						<li class="mui-table-view-cell">
							<p>现在能为父母的健康做点什么？</p>
							<p>摘要：先说说我家的情况，我爸爱抽烟，每天感觉能达到一包，我妈前几年腰间盘突出，现在好了，我家在农村，家里人收入可以约...</p>
							<p>57赞·3评论·关注</p>
						</li>-->
					</ul>
				</div>
			</div>

		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<!--<script src="../../js/utils/h5fresh.js"></script>-->
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/publicProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/storageKeyName.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/publicQiuzhiProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var pageIndex = 1; //请求数据页面
			var totalPageCount; //总页码
			var flagRef = 0; //是刷新0，还是加载更多1
			var answerArray = []; //回答总数组
			var keyWord = "getAsksByCondition";
			mui.init();
			mui.plusReady(function() {
				//注册点击搜索事件
				//点击 将文本框内容存于变量 并执行下拉刷新所需逻辑
				/*		document.getElementById('search-btn').addEventListener('tap', function() {
							keyWord = mui("#search-keyWord")[0].value;
							console.log(keyWord)
							document.getElementById('list-container').innerHTML = "";
							console.log("搜索");
							pageIndex = 1;
							flagRef = 0;
							//33.获取某个用户的评论列表
							getAsksByCondition(keyWord);
						})*/
				document.getElementById('search-btn').addEventListener('tap', searchQuestion);
				var search_keyWord = document.getElementById('search-keyWord');
				search_keyWord.addEventListener('search',searchQuestion)

				//上拉下拉注册
				mui(".mui-scroll-wrapper .mui-scroll").pullToRefresh({
					down: {
						callback: function() {
							//清除节点
							document.getElementById('list-container').innerHTML = "";
							var self = this;
							console.log("下拉刷新");
							pageIndex = 1;
							flagRef = 0;
							//33.获取某个用户的评论列表
							getAsksByCondition(keyWord);
							self.endPullDownToRefresh();
						}
					},
					up: {
						callback: function() {
							var self = this;
							console.log("上拉加载更多");
							flagRef = 1;
							console.log(totalPageCount);
							if(pageIndex < totalPageCount) {
								//33.获取某个用户的评论列表
								pageIndex++;
								getAsksByCondition(keyWord);
							} else {
								mui.toast('没有更多了');
							}
							self.endPullUpToRefresh();
						}
					}
				});

			});

			function searchQuestion() {
			 
					keyWord = mui("#search-keyWord")[0].value;
					console.log(keyWord)
					document.getElementById('list-container').innerHTML = "";
					console.log("搜索");
					pageIndex = 1;
					flagRef = 0;
					//33.获取某个用户的评论列表
					getAsksByCondition(keyWord);
			}
			//4.获取所有符合条件问题
			function getAsksByCondition(askTitle) {
				//需要加密的数据
				console.log("11111111111111");
				var comData = {
					askTitle: askTitle, //问题标题,用于查找，可输入部分标题
					channelId: '0', //话题ID,传入0，获取所有话题数据
					pageIndex: pageIndex, //当前页数
					pageSize: '10' //每页记录数,传入0，获取总记录数
				};
				// 等待的对话框
				var wd = events.showWaiting();
				//4.获取所有符合条件问题
				postDataQZPro_getAsksByCondition(comData, wd, function(data) {
					wd.close();
					console.log('4.获取所有符合条件问题:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
					if(data.RspCode == 0) {
						totalPageCount = data.RspData.totalPage;
						setQuestionRecord(data.RspData.Data);
					} else {
						mui.toast(data.RspTxt);
					}
				});
			};

			/**
			 * 放置邀请回答记录数据
			 * @param {Object} list 回答记录数据
			 */
			var setQuestionRecord = function(list) {
				var listContainer = document.getElementById('list-container');
				for(var i in list) {
					createList(listContainer, list[i])
				}
			}
			/**
			 * 拼接回答记录
			 * @param {Object} listContainer
			 * @param {Object} record
			 */
			var createList = function(listContainer, record) {
				var li = document.createElement('li');
				li.className = 'mui-table-view-cell';
				//拼接显示

				//				<li class="mui-table-view-cell">
				//	<p>现在能为父母的健康做点什么？</p>
				//	<p>摘要：先说说我家的情况，我爸爱抽烟，每天感觉能达到一包，我妈前几年腰间盘突出，现在好了，我家在农村，家里人收入可以约...</p>
				//	<p>57赞·3评论·关注</p>
				//</li>
				//li.innerHTML = "<p>" + record.CommentContent + "</p><div><p><img src='"+record.qChannelImg+"'>["+record.qChannel+"]"+record.AskTitle+"</p><p>"+record.AnswerContent+"</p></div><p>"+record.LikeNum+" 赞 · "+record.cCreatTime + " ·"+record.CommentId+" 关注</p>";
				li.innerHTML = "<p>" + record.AskTitle + "</p><p>" + record.AnswerContent + "</p><p>" + record.IsLikeNum + "赞·" + record.CommentNum + "评论</p>";
				listContainer.appendChild(li);
			}
		</script>
	</body>

</html>