<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<link href="../../css/iconfont/iconfont.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/quan/custom-textarea.css"/>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="color: white;">我要回答</h1>
			<h1 id="submitBtn" class="mui-icon mui-icon-right-nav mui-pull-right" style="text-align: right;right: 10px;font-size: 15px;">提交</h1>
		</header>

		<div class="mui-content">
			<p id="askTitle" style="margin-left: 10px;font-size: 14px;margin-top: 5px;"></p>
			<div class="input-content">
				<textarea id="answerContent" placeholder="添加回答"></textarea>
				<div id="take_pic" class="take_pic">
					<a class="mui-icon iconfont icon-xiangji1"></a>
				</div>
				<div id="take_camero" class="take_camero">
					<a class="mui-icon iconfont icon-shipin"></a>
				</div>
				<div id="get_gallery" class="get_gallery">
					<a class="mui-icon iconfont icon-tuku"></a>
				</div>
			</div>
			<div class="mui-input-row mui-checkbox mui-left" style="float: right;width: 100px;margin-top: -35px;margin-left: -100px;">
				<label>匿名</label>
				<input id="checkbox" name="checkbox" value="" type="checkbox">
			</div>
		</div>

		<script src="../../js/mui.min.js"></script>
		<script src="../../js/utils/events.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/publicQiuzhiProtocol.js" type="text/javascript" charset="utf-8"></script>

		<script type="text/javascript">
			mui.init();
			//将传值到的标题显示
			var askModel; //问题model
			//传值接收方法
			window.addEventListener('qiuzhi-addAnswer', function(event) {
				askModel = event.detail.data;
				var askTitle = document.getElementById("askTitle");
				askTitle.innerHTML = askModel.AskTitle;
			});
			mui.plusReady(function() {
				mui('#ExpertList').on('tap', '.checkbox', function() {
					this.checked = !this.checked;
					window.event.stopPropagation();
				})
			});
			
			events.addTap('take_pic', function() {
				mui.toast('此功能暂未开放');
				//				camera.getPic(camera.getCamera(), function(path) {
				//
				//				});
			});
			events.addTap('take_camero', function() {
				mui.toast('此功能暂未开放');
				//				camera.getVideo(camera.getCamera(), function(path) {
				//
				//				});
			});
			events.addTap('get_gallery', function() {
				mui.toast('此功能暂未开放');
				//				gallery.getMultiplePic(function(paths) {
				//
				//				});
			});

			//提交按钮
			events.addTap('submitBtn', function() {
				var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid; //用户id
				var answerContent = Trim(document.getElementById("answerContent").value);
				if(!answerContent || answerContent == '') {
					mui.toast('请输入内容');
					return;
				} else if(answerContent.length > 4000) {
					mui.toast('不能超过4000字');
					return;
				}
				var checkboxBtn = document.getElementById("checkbox");
				if (checkboxBtn.checked) {
//					personalUTID = '';
				}
				
				//所需参数
				var comData = {
					askId: askModel.TabId, //问题ID
					answerContent: answerContent, //回答内容,4000
					encAddr: '', //附件地址,300,多个的情况例如：1.jpg|2.jpg
					answerMan: personalUTID //回答人
				};
				// 等待的对话框
				var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
				//9.新增某个用户回答问题
				postDataQZPro_addAnswer(comData, wd, function(data) {
					wd.close();
					console.log('9.新增某个用户回答问题:' + JSON.stringify(data));
					if(data.RspCode == 0) {
						mui.toast('回答成功')
						document.getElementById("answerContent").value = '';
						events.fireToPageNone('qiuzhi-questionSub.html','answerAdded');
						mui.back();
					} else {
						mui.toast(data.RspTxt);
					}
				});

			});
			//去除前后空格
			function Trim(str) {
				return str.replace(/(^\s*)|(\s*$)/g, "");
			}
		</script>
	</body>

</html>