<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<link href="../../css/iconfont/iconfont.css" rel="stylesheet" />
		<link href="../../css/qiuzhi/qiuzhi-inviteAnswer.css" rel="stylesheet" />
		<style>
			.mui-table h4,
			.mui-table h5,
			.mui-table .mui-h5,
			.mui-table .mui-h6,
			.mui-table p {
				margin-top: 0;
				padding-left: 10px;
			}
			
			.mui-table h4 {
				line-height: 21px;
				font-weight: 500;
				padding-left: 10px;
			}
			
			.mui-table .oa-icon {
				position: absolute;
				right: 0;
				bottom: 0;
			}
			
			.mui-table .oa-icon-star-filled {
				color: #f14e41;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">他的提问</h1>
		</header>
		<div id="refreshContainer" class="mui-content">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul id="list-container" class="mui-table-view mui-table-view-striped mui-table-view-condensed">

					</ul>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<!--<script src="../../js/utils/h5fresh.js"></script>-->
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/publicProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/storageKeyName.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/publicQiuzhiProtocol.js" type="text/javascript" charset="utf-8"></script>
	</body>

</html>

<script type="text/javascript">
	var ExpertsInfo; //专家详细页传来的 专家信息
	var pageIndex = 1; //请求数据页面
	var totalPageCount; //总页码
	var flagRef = 0; //是刷新0，还是加载更多1
	var datasource = []; //回答总数组

	mui.init();
	mui.plusReady(function() {
		ExpertsInfo = plus.webview.currentWebview().data;
		//25.获取某个用户的提问列表
		getAsksByUser(ExpertsInfo.UserId);
		console.log('专家回答页传值：' + JSON.stringify(ExpertsInfo));
		mui('.mui-table-view').on('tap', '.mui-table-view-cell', function() {
			var index = this.id.replace('li', '');
			events.fireToPageNone('qiuzhi-question.html', datasource[index].AskId);
			events.fireToPageNone('qiuzhi-questionSub.html', 'askId', datasource[index].AskId);
			plus.webview.getWebviewById('qiuzhi-question.html').show();
		});
		mui(".mui-scroll-wrapper .mui-scroll").pullToRefresh({
			down: {
				callback: function() {
					//清除节点
					document.getElementById('list-container').innerHTML = "";
					var self = this;
					console.log("下拉刷新");
					pageIndex = 1;
					flagRef = 0;
					getAsksByUser(ExpertsInfo.UserId);
					self.endPullDownToRefresh();
				}
			},
			up: {
				callback: function() {
					var self = this;
					console.log("上拉加载更多");
					flagRef = 1;
					if(pageIndex < totalPageCount) {
						getAsksByUser(ExpertsInfo.UserId);
					} else {
						mui.toast('没有更多了');
					}
					self.endPullUpToRefresh();
				}
			}
		});

	});

	//25.获取某个用户的提问列表
	function getAsksByUser(userId) { //需要加密的数据
		var comData = {
			userId: userId, //用户ID
			pageIndex: '1', //当前页数
			pageSize: '10' //每页记录数,传入0，获取总记录数
		};
		// 等待的对话框
		var wd = events.showWaiting();
		//25.获取某个用户的提问列表
		postDataQZPro_getAsksByUser(comData, wd, function(data) {
			wd.close();
			console.log('25.获取某个用户的提问列表:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
			if(data.RspCode == 0) {
				//总页数
				totalPageCount = data.RspData.TotalPage;
				if(flagRef == 0) { //刷新
					datasource = data.RspData.Data;
				} else { //加载更多
					pageIndex++;
					//合并数组
					datasource = datasource.concat(data.RspData.Data);
				}
				addData();
			} else {
				mui.toast(data.RspTxt);
			}
		});
	};

	function addData() {
		for(var i = 0; i < datasource.length; i++) {
			var list = document.getElementById("list-container");
			var li = document.createElement("li");
			li.id = 'li' + i;
			li.className = 'mui-table-view-cell';
			li.innerHTML = '<div class="mui-table"><div class="mui-table-cell mui-col-xs-12">' +
				'<h4 class="mui-ellipsis">' + datasource[i].AskTitle +
				'</h4><p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答 ' + datasource[i].AskTime + ' ' + datasource[i].FocusNum + '关注</p></div></div>'
			list.appendChild(li);
		}

	}
</script>
</body>

</html>