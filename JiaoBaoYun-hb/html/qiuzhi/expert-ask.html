<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<link href="../../css/iconfont/iconfont.css" rel="stylesheet" />
		<!--<link href="../../css/qiuzhi/qiuzhi-inviteAnswer.css" rel="stylesheet" />-->
		<style>
			.mui-scroll-wrapper {
				padding-top: 44px;
			}
			
			.mui-bar~.mui-content .mui-fullscreen {
				top: 44px;
				height: auto;
			}
			
			.mui-pull-top-tips {
				position: absolute;
				top: -20px;
				left: 50%;
				margin-left: -25px;
				width: 40px;
				height: 40px;
				border-radius: 100%;
				z-index: 1;
			}
			
			.mui-bar~.mui-pull-top-tips {
				top: 24px;
			}
			
			.mui-pull-top-wrapper {
				width: 42px;
				height: 42px;
				display: block;
				text-align: center;
				background-color: #efeff4;
				border: 1px solid #ddd;
				border-radius: 25px;
				background-clip: padding-box;
				box-shadow: 0 4px 10px #bbb;
				overflow: hidden;
			}
			
			.mui-pull-top-tips.mui-transitioning {
				-webkit-transition-duration: 200ms;
				transition-duration: 200ms;
			}
			
			.mui-pull-top-tips .mui-pull-loading {
				/*-webkit-backface-visibility: hidden;
				-webkit-transition-duration: 400ms;
				transition-duration: 400ms;*/
				margin: 0;
			}
			
			.mui-pull-top-wrapper .mui-icon,
			.mui-pull-top-wrapper .mui-spinner {
				margin-top: 7px;
			}
			
			.mui-pull-top-wrapper .mui-icon.mui-reverse {
				/*-webkit-transform: rotate(180deg) translateZ(0);*/
			}
			
			.mui-pull-bottom-tips {
				text-align: center;
				background-color: #efeff4;
				font-size: 15px;
				line-height: 40px;
				color: #777;
			}
			
			.mui-pull-top-canvas {
				overflow: hidden;
				background-color: #fafafa;
				border-radius: 40px;
				box-shadow: 0 4px 10px #bbb;
				width: 40px;
				height: 40px;
				margin: 0 auto;
			}
			
			.mui-pull-top-canvas canvas {
				width: 40px;
			}
			
			.mui-table h4,
			.mui-table h5,
			.mui-table .mui-h5,
			.mui-table .mui-h6,
			.mui-table p {
				margin-top: 0;
				padding-left: 10px;
			}
			
			.mui-table h4 {
				line-height: 21px;
				font-weight: 500;
				padding-left: 10px;
			}
			
			.mui-table .oa-icon {
				position: absolute;
				right: 0;
				bottom: 0;
			}
			
			.mui-table .oa-icon-star-filled {
				color: #f14e41;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">全部提问</h1>
		</header>
		<div id="refreshContainer" class="mui-content mui-fullscreen" style="z-index:0">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul id="list-container" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
						<!--<li class="mui-table-view-cell">
							<div class="mui-table">
								<div class="mui-table-cell mui-col-xs-12">
									<h4 class="mui-ellipsis">啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊</h4>
									<p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答 ' + datasource[i].AskTime + ' ' + datasource[i].FocusNum + '关注</p>
								</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-table">
								<div class="mui-table-cell mui-col-xs-12">
									<h4 class="mui-ellipsis">啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊</h4>
									<p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答 ' + datasource[i].AskTime + ' ' + datasource[i].FocusNum + '关注</p>
								</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-table">
								<div class="mui-table-cell mui-col-xs-12">
									<h4 class="mui-ellipsis">啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊</h4>
									<p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答 ' + datasource[i].AskTime + ' ' + datasource[i].FocusNum + '关注</p>
								</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-table">
								<div class="mui-table-cell mui-col-xs-12">
									<h4 class="mui-ellipsis">啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊</h4>
									<p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答 ' + datasource[i].AskTime + ' ' + datasource[i].FocusNum + '关注</p>
								</div>
							</div>
						</li>-->
					</ul>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/mui.pullToRefresh.js"></script>
		<script src="../../js/mui.pullToRefresh.material.js"></script>
		<!--<script src="../../js/utils/h5fresh.js"></script>-->
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/publicProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/storageKeyName.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/publicQiuzhiProtocol.js" type="text/javascript" charset="utf-8"></script>
	</body>

</html>

<script type="text/javascript">
	var ExpertsInfo; //专家详细页传来的 专家信息
	var pageIndex = 1; //请求数据页面
	var totalPageCount; //总页码
	var flagRef = 0; //是刷新0，还是加载更多1
	var datasource = []; //回答总数组

	mui.init();
	mui.plusReady(function() {
		ExpertsInfo = plus.webview.currentWebview().data;
		//25.获取某个用户的提问列表

		console.log('专家回答页传值：' + JSON.stringify(ExpertsInfo));
		mui('.mui-table-view').on('tap', '.mui-table-view-cell', function() {
			var index = this.id.replace('li', '');
			events.fireToPageNone('qiuzhi-question.html', datasource[index].AskId);
			events.fireToPageNone('qiuzhi-questionSub.html', 'askId', datasource[index].AskId);
			plus.webview.getWebviewById('qiuzhi-question.html').show();
		});
		getAsksByUser(ExpertsInfo.UserId);
		mui(".mui-scroll-wrapper .mui-scroll").pullToRefresh({
			down: {
				callback: function() {
					//清除节点
					document.getElementById('list-container').innerHTML = "";
					var self = this;
					console.log("下拉刷新");
					pageIndex = 1;
					flagRef = 0;
					getAsksByUser(ExpertsInfo.UserId);
					setTimeout(function() {
						//结束下拉刷新
						self.endPullDownToRefresh();
					}, 1000);
				}
			},
			up: {
				callback: function() {
					var self = this;
					console.log("上拉加载更多");
					flagRef = 1;
					if(pageIndex <= totalPageCount) {
						getAsksByUser(ExpertsInfo.UserId);
					} else {
						mui.toast('没有更多了');
					}
					setTimeout(function() {
						//结束下拉刷新
						self.endPullUpToRefresh();
						if(mui(".mui-table-view-cell").length < 10) {
							mui(".mui-pull-loading")[0].innerHTML = "";
						}
					}, 1000);
				}
			}
		});
	});

	//25.获取某个用户的提问列表
	function getAsksByUser(userId) { //需要加密的数据
		var comData = {
			userId: userId, //用户ID
			pageIndex: pageIndex, //当前页数
			pageSize: '10' //每页记录数,传入0，获取总记录数
		};
		// 等待的对话框
		var wd = events.showWaiting();
		//25.获取某个用户的提问列表
		postDataQZPro_getAsksByUser(comData, wd, function(data) {
			wd.close();
			console.log('25.获取某个用户的提问列表:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
			if(data.RspCode == 0) {
				//总页数
				totalPageCount = data.RspData.TotalPage;
				pageIndex++;
				if(flagRef == 0) { //刷新
					datasource = data.RspData.Data;
				} else { //加载更多
					//合并数组
					datasource = datasource.concat(data.RspData.Data);
				}
				addData();
			} else {
				mui.toast(data.RspTxt);
			}
		});
	};

	function addData() {
		for(var i = 0; i < datasource.length; i++) {
			var str_Time = modifyTimeFormat(datasource[i].AskTime);
			var list = document.getElementById("list-container");
			var li = document.createElement("li");
			li.id = 'li' + i;
			li.className = 'mui-table-view-cell';
			li.innerHTML = '<div class="mui-table"><div class="mui-table-cell mui-col-xs-12">' +
				'<h4 class="mui-ellipsis">' + datasource[i].AskTitle +
				'</h4><p class="mui-h6 mui-ellipsis">' + datasource[i].AnswerNum + '回答  ' + datasource[i].FocusNum + '关注  ' + str_Time + '</p></div></div>'
			list.appendChild(li);
		}
	}
</script>
</body>

</html>