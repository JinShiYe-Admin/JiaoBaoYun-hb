<!--
	作者：444811716@qq.com
	时间：2016-10-26
	描述：云盘主页
-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<link rel="stylesheet" href="../../css/iconfont/iconfont.css" />
		<link rel="stylesheet" href="../../css/cloud/file.css" />
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/cloud/cloud.js"></script>
		<style>
			.mui-table-view:before,
			.mui-table-view:after,
			.mui-table-view-cell:after {
				height: 0px;
			}

			.mui-table-view-cell {
				background: white;
			}

			.mui-table-view.mui-grid-view .mui-table-view-cell {
				margin-right: 0px;
			}

			.cloud-bottom-imge2 {
				height: 40px !important;
				width: 40px !important;
			}

			.cloud-bottom-imge3 {
				height: 40px;
				width: 40px;
				/*padding: 5px;
				padding-top: 0px;*/
			}

			.cloud-bottom-imge2-bg {
				/*云档案，云应用的图片背景*/
				height: 40px;
				width: 40px;
				border-radius: 50%;
				margin: auto;
			}

			.cloud-bottom-icon {
				/*云存储右侧按钮*/
				height: 20px;
				width: 20px;
			}

			.cloud-text-align-center {
				text-align: center;
			}

			.cloud-line {
				/*功能名字右侧树竖线*/
				position: absolute;
				right: 0;
				top: 1%;
				width: 1px;
				background: #D9D9D9;
				height: 100%;
			}

			#cloudstorage,
			#cloudapps,
			#cloudrecord {
				background-color: white;
				padding: 10px;
				margin: 0;
			}

			.mui-table-view {
				background: transparent;
				min-height: 90px;
				margin: 5px 0 !important;
				padding: 16px 0 !important;
			}

			.mui-progressbar {
				border-radius: 5px;
				background-color: #EBEBEB;
			}

			.mui-progressbar span {
				background-color: #4aa5fc;
			}

			.cloud-file-icon {
				font-size: 30px;
				padding-top: 10px;
			}

			.cloud-iconfont {
				/*其他图标*/
				font-size: 30px;
				color: white;
				line-height: 30px;
				margin: 0px !important;
				border: none !important;
			}

			.mui-slider-indicator .mui-icon {
				font-size: 40px;
				/*line-height: 30px;*/
			}

			.mui-segmented-control.mui-scroll-wrapper .mui-control-item {
				padding: 0px 0px;
				margin: 0px;
			}

			.mui-table-view.mui-grid-view .cloud-font {
				font-weight: bold;
				width: 16%;
				padding: 0 12px;
			}

			.mui-segmented-control {
				border: none;
			}

			.mui-segmented-control .mui-control-item {
				line-height: normal;
			}

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: inherit;
				border-bottom: none;
			}

			.mui-slider-indicator .mui-icon {
				border: none;
				/*font-size: 35px;*/
			}

			.mui-ellipsis {}
		</style>
	</head>

	<body>
		<div class="mui-content">
			<div class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<div id="bottom" style="width: 100%;position: relative;">
						<!--云盘-->
						<ul id="cloudstorage" class="mui-table-view mui-grid-view" style="padding-right: 0px;">
							<li id="cloudstoragename" class="mui-table-view-cell mui-media cloud-font" style="width: 16%;">
								云<br/>盘
							</li>
							<li class="mui-table-view-cell mui-media" style="padding: 0px;margin: 0;width:84%;border-left: 1px solid #d9d9d9;">
								<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 80px;padding-left: 5px;padding-right: 5px;">
									<div id="cloudstorage_0" class="mui-scroll">
										<!--<a class="mui-control-item"style="width: 61px;">
												<img class="cloud-bottom-imge2" src="../../image/cloud/note.png" />
												<p class="mui-ellipsis">手机通讯录</p>
											</a>
											<a class="mui-control-item"style="width: 61px;">
												<img class="cloud-bottom-imge2" src="../../image/cloud/note.png" />
												<p class="mui-ellipsis">手机图库</p>
											</a>-->
									</div>
								</div>
								<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 80px;padding-left: 5px;padding-right: 5px;">
									<div id="cloudstorage_1" class="mui-scroll">
										<!--<a class="mui-control-item" style="background: red;">
											<span class="mui-icon iconfont icon-newfolder cloud-file-icon" style="color: #0ABAF5;"></span>
											<p class="mui-ellipsis">新</p>
										</a>
										<a class="mui-control-item"style="background: blanchedalmond;">
											<span class="mui-icon iconfont icon-video cloud-file-icon" style="color: #0ABAF5;"></span>
											<p class="mui-ellipsis">建</p>
										</a>
										<a class="mui-control-item"style="background: blanchedalmond;">
											<span class="mui-icon iconfont icon-file cloud-file-icon" style="color: #0ABAF5;"></span>
											<p class="mui-ellipsis">建</p>
										</a>
										<a class="mui-control-item"style="background: burlywood;">
											<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_wenjianjia.png" />
											<p class="mui-ellipsis">新建文件夹</p>
										</a>-->
									</div>
								</div>
							</li>
						</ul>
						<!--家校互动-->
						<ul id="cloudrecord" class="mui-table-view mui-grid-view">
							<li class="mui-table-view-cell mui-media cloud-font" style="width: 16%;">
								家<br />校<br />互<br />动
							</li>
							<li class="mui-table-view-cell mui-media" style="padding: 0px;margin: 0;width:84%;border-left: 1px solid #d9d9d9;">
								<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 80px;padding-left: 5px;padding-right: 5px;">
									<div id="cloudrecord_0" class="mui-scroll">
									</div>
								</div>
								<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 80px;padding-left: 5px;padding-right: 5px;">
									<div id="cloudrecord_1" class="mui-scroll">
									</div>
								</div>
							</li>
						</ul>
						<!--云应用-->
						<ul id="cloudapps" class="mui-table-view mui-grid-view">
							<li class="mui-table-view-cell mui-media cloud-font" style="width: 16%;">
								应<br/>用
							</li>
							<li class="mui-table-view-cell mui-media" style="padding: 0px;margin: 0;width:84%;border-left: 1px solid #d9d9d9;">
								<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 80px;padding-left: 5px;padding-right: 5px;">
									<div id="cloudapps_0" class="mui-scroll">
									</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			mui.init();

			//声明变量
			//文件存储数组
			var fileArray = [];
			//获取所有的群
			var datasource = [];
			//获取学生列表
			var topStudentArr = [];

			mui.plusReady(function() {
				events.preload("../homework/homework-tea.html", 300);
				events.preload('storage_main.html'); //预加载云存储
				events.preload('storage_upload.html'); //预加载上传文件选择
				events.preload('storage_upload_choose.html'); //预加载选择上传文件的方式
				//初始化滚动条
				//---滑动start---
				mui(".mui-scroll-wrapper").scroll({
					scrollY: true, //是否竖向滚动
					scrollX: false, //是否横向滚动
					indicators: true, //是否显示滚动条
					deceleration: 0.0006, //阻尼系数,系数越小滑动越灵敏
					bounce: true, //是否启用回弹
				});
				//---滑动end---

				//屏幕宽度
				var screenWidth = plus.screen.resolutionWidth;
				//console.log('screenWidth:' + screenWidth);
				//左侧文字宽度
				var nameWidth = document.getElementById("cloudstoragename").offsetWidth;
				//console.log('nameWidth:' + nameWidth);
				//每个图标的宽度
				var maxWidth = (screenWidth * 1 - nameWidth * 1 - 5) / 4.5;
				//console.log('maxWidth:' + maxWidth);
				//				mui('.mui-control-item').each(function(index, element) {
				//					element.style.width = maxWidth + 'px';
				//				});

				//-----------设置数据start---------------
				addcloudapps_0(); //应用
				changeData();
				//-----------设置数据end---------------

				//重新登录或者自动登录后获取的信息
				window.addEventListener('infoChanged', function() {
					//文件存储数组
					fileArray = [];
					//获取所有的群
					datasource = [];
					//获取学生列表
					topStudentArr = [];
					//changeInfo();
					changeData();
					events.fireToPageNone('storage_upload.html', 'createFolder'); //在程序中创建utid的文件夹和对应的上传下载文件夹
				});

				//修改用户信息
				window.addEventListener('personChanged', function() {
					//设置页面信息
					//changeInfo();
				});

				//修改云存储信息
				window.addEventListener('cloudDataChange', function() {
					//设置页面信息
					changeCloudData();
				});

				//-----------设置数据end-----------------

				//-----------设置监听start---------------

				//---云盘start---
				//云盘第一行
				mui('#cloudstorage_0').on('tap', '.mui-control-item', function() {
					var id = this.id;
					if(id == 'shoujitongxunlu') { //手机通讯录
						mui.toast('手机通讯录功能暂未开放');
					} else if(id == 'shoujituku') { //手机图库
						mui.toast('手机图库功能暂未开放');
					} else { //档案
						events.openNewWindowWithData('record_student_main.html', {
							StudentId: this.getAttribute('StudentId'), //学生ID
							StudentName: this.getAttribute('StudentName') //学生姓名
						});
					}
				});

				//云存储显示的文件
				mui('#cloudstorage_1').on('tap', '.mui-control-item', function() {
					if(this.id != 'addFolder') {
						events.fireToPageWithData('storage_main.html', 'init', {
							fid: '0', //文件id,顶层0
							showTop: true, //是否显示顶部的上传，传输列表，文件夹，如果是选择云盘上的文件夹则为false
							title: '云盘—云存储', //标题名
							top: fileArray //顶层文件和文件夹的数据
						});
					}
				});

				//增加文件夹
				mui('#cloudstorage').on('tap', '#addFolder', function(e) {
					e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
					var btnArray = ['取消', '确定'];
					mui.prompt('请输入新文件夹的名称：', '新文件夹', '新建文件夹', btnArray, function(e) {
						if(e.index == 1) { //点击确定
							var reg = new RegExp('^[^\\\\\\/:*?\\"<>|]+$'); //特殊字符过滤的正则表达式
							if(e.value.replace(/(^\s*)|(\s*$)/g, "") == "") {
								mui.toast('文件夹名字不能为空');
							} else if(!reg.test(e.value)) {
								//特殊字符
								mui.toast('名字中不能包含这些字符 \ / : * ? " < > | ');
							} else {
								//27.用户云盘文件上传或创建文件夹
								//所需参数
								var comData = {
									pid: '0', //	父ID，该文件的上层ID
									fname: e.value, //	文件名称，文件或文件夹名称,文件存扩展名之前的名称
									ftype: '.file', //	文件类型，存文件的扩展名,如.file为文件夹
									fpath: '', //	文件路径，文件路径,为文件用
									fsize: '0' //	文件大小，文件用
								};
								// 等待的对话框
								var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
								postDataPro_PostDiFiA(comData, wd, function(data) {
									wd.close();
									console.log('27.postDataPro_PostDiFiA:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
									if(data.RspCode == 0) {
										//26.用户云盘顶层文件及文件夹获取
										postFirstFile();
									} else if(data.RspCode == 8) {
										mui.toast('操作失败！已存在相同的名字');
									} else {
										mui.toast(data.RspTxt);
									}
								});
							}
						} else {
							//点击取消
						}
					}, 'div');
					document.querySelector('.mui-popup-input input').type = 'text';
					document.querySelector('.mui-popup-input input').maxLength = '20';
				});

				//---云盘end---

				//---家校互动---start---
				mui('#cloudrecord_0').on('tap', '.mui-control-item', function() {
					var id = this.id;
					if(id == 'homework') { //作业
						requestClassData();
					} else if(id == 'manage') { //班级管理
						events.openNewWindow('/html/mine/qun_manage.html');
					} else { //学生
						console.log('学生');
					}
				});

				mui('#cloudrecord_1').on('tap', '.mui-control-item', function() {
					console.log('班级');
				});
				//---家校互动---end---

				//---应用---start---
				mui('#cloudapps').on('tap', '.mui-control-item', function() {
					var value = this.getAttribute("value");
					switch(value) {
						case "0": //笔记
							events.openNewWindow('app_notes_main.html');
							break;
						case "1": //记事
							events.openNewWindow('app_keeprecord.html');
							break;
					}
				});
				//---应用---end---

				//-----------设置监听end---------------

				/**
				 * 修改云盘的文件，档案数据
				 */
				function changeData() {
					document.getElementById("cloudstorage_0").innerHTML = '';
					document.getElementById("cloudstorage_1").innerHTML = '';
					//26.用户云盘顶层文件及文件夹获取
					postFirstFile();
					//73.（云档案）按家长获取学生档案姓名
					postUserStudent();
					//获取学生
					getStuList();
					//获取班级
					getGroupList();
				}

				/**
				 * 修改云盘的文件
				 */
				function changeCloudData() {
					document.getElementById("cloudstorage_1").innerHTML = '';
					//26.用户云盘顶层文件及文件夹获取
					postFirstFile();
				}

				/**
				 * 获取用户所在群数据
				 */
				function requestClassData() {
					var teacherClasses = [];
					var studentClasses = [];
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//获取当前账号，所在的群
					//需要参数
					var comData = {
						vtp: 'ag', //要获取的项:cg(创建的群),ug(参与群),mg(协管的群),ag(所有的群),ig(群信息vvl对应群ID)
						vvl: personalUTID //查询的各项，对应人的utid，可以是查询的任何人
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//9.获取用户群
					postDataPro_PostGList(comData, wd, function(data) {
						wd.close();
						console.log('作业主界面获取的群信息：' + JSON.stringify(data));
						if(data.RspCode == 0) {
							var tempArray = data.RspData;
							//			gid:'14',//群ID
							//			gname:'10群',//群名
							//			gimg:'',//群头像,群头像的链接
							//			mstype:'2'//用户角色,0家长,1管理员,2老师,3学生
							//然后检索身份为老师或者家长、学生的
							for(var i in tempArray) {
								var tempModel = tempArray[i];

								var isHave = false;
								//2老师
								if(tempModel.mstype == 2 || tempModel.mstype == 1) {
									for(var m in teacherClasses) {
										if(tempModel.gid == teacherClasses[m].gid) {
											isHave = true;
											break;
										}
									}
									if(!isHave) {
										teacherClasses.push(tempModel);
									}
								}
								var isHave1 = false;
								//家长、学生
								if(tempModel.mstype == 0 || tempModel.mstype == 3) {
									for(var m in studentClasses) {
										if(tempModel.gid == studentClasses[m].gid) {
											isHave1 = true;
											break;
										}
									}
									if(!isHave1) {
										studentClasses.push(tempModel);
									}
								}
							}
							if(teacherClasses.length > 0 || studentClasses.length > 0) {
								console.log('teacherClasses:' + teacherClasses.length + ',' + studentClasses.length);
								events.fireToPageWithData('../homework/homework-tea.html', 'postClasses', {
									teacherClasses: teacherClasses,
									studentClasses: studentClasses
								})
							} else {
								mui.toast('您还未加入班级');
							}
						} else {
							mui.toast(data.RspTxt);
						}
					});
				}

				//26.用户云盘顶层文件及文件夹获取
				function postFirstFile() {
					//所需参数
					var comData = {
						vvl: '0' //	节点ID，顶层为0
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_PostDiFi(comData, wd, function(data) {
						document.getElementById("cloudstorage_1").innerHTML = '';;
						addStorageIcon();
						console.log('26.postDataPro_PostDiFi_用户云盘顶层文件及文件夹获取_RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							//给存储数组赋值
							if(data.RspData != null && data.RspData != '') {
								fileArray = data.RspData;
							} else {
								fileArray = [];
							}
							//清掉所有文件夹
							document.getElementById("cloudstorage_1").innerHTML = '';;
							//循环将获取到的值塞入界面
							var folder = 0;
							mui.each(data.RspData, function(index, element) {
								//								if(folder == 4) {
								//									return false;
								//								}
								if(element.ftype == '.file') {
									folder++;
									addStorageFolder(element);
								}
							});
							//if(folder < 4) {
							mui.each(data.RspData, function(index, element) {
								//									if(folder == 4) {
								//										return false;
								//									}
								if(element.ftype != '.file') {
									folder++;
									addStorageFolder(element);
								}
							});
							//}
							//增加加号
							//if(fileArray.length < 4) {
							addStorageIcon();
							//}
						} else if(data.RspCode == 9) {

						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				//73.（云档案）按家长获取学生档案姓名
				function postUserStudent() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//73.（云档案）按家长获取学生档案姓名
					//所需参数
					var comData = {
						parentId: personalUTID //家长ID
					};
					//返回学生姓名数组
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_getStudentName(comData, wd, function(data) {
						console.log('73.云档案）按家长获取学生档案姓名postDataPro_getStudentName:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						document.getElementById("cloudstorage_0").innerHTML = '';
						addcloudstorage_0_0(); //手机通讯录，手机图库
						if(data.RspCode == 0) {
							//设置页面显示
							mui.each(data.RspData.Students, function(index, item) {
								//console.log('学生档案：' + index + '|' + JSON.stringify(item));
								addcloudstorage_0_1(item);
							});
						} else if(data.RspCode == 9) {} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				/**
				 * 增加存储的文件夹或文件
				 * @param {Object} data
				 */
				function addStorageFolder(data) {
					var a = document.createElement("a");
					a.setAttribute('data-fid', data.fid);
					a.className = 'mui-control-item';
					var html1 = ''; //图标
					var html2 = ''; //名字
					if(data.ftype == '.file') { //文件夹
						html1 = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_wenjianjia.png"/>';
						html2 = '<p class="mui-ellipsis">' + data.fname + '</p>';
					} else { //文件
						var type = cloud.classify(data.ftype);
						var pathList = data.fpath.split('/');
						var pathList2 = pathList[pathList.length - 1].split('.');
						var fileName = pathList2[0];
						var path = window.storageKeyName.QNFILEIMGEDOMAIN + fileName + '.PNG';
						if(type != '') {
							html1 = '<span class="mui-icon iconfont ' + type + ' cloud-file-icon"></span>';
						} else { //七牛能生成缩略图的图片或视频
							html1 = '<img class="cloud-bottom-imge3" src="' + path + '"/>';
						}
						html2 = '<p class="mui-ellipsis" style="margin-top:2px;">' + data.fname + data.ftype + '</p>';
					}
					a.innerHTML = html1 + html2;
					a.style.width = maxWidth + 'px';
					a.style.height = '80px';
					a.style.marginTop = '10px';
					document.getElementById("cloudstorage_1").appendChild(a);

				}

				/**
				 * 增加文件夹的按钮（加号按钮）
				 */
				function addStorageIcon() {
					var a = document.createElement('a');
					a.id = 'addFolder';
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_xinjian.png" /><p class="mui-ellipsis">新建文件夹</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '80px';
					a.style.marginTop = '10px';
					document.getElementById("cloudstorage_1").appendChild(a);
				}

				/**
				 * 增加手机通讯录和手机图库
				 */
				function addcloudstorage_0_0() {
					//手机通讯录
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_tongxunlu.png" />\
									   <p class="mui-ellipsis">手机通讯录</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '80px';
					a.style.marginTop = '10px';
					a.id = 'shoujitongxunlu';
					document.getElementById("cloudstorage_0").appendChild(a);

					//手机图库
					var a2 = document.createElement('a');
					a2.className = 'mui-control-item';
					a2.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_tuku.png" />\
									   <p class="mui-ellipsis">手机图库</p>';
					a2.style.width = maxWidth + 'px';
					a2.style.height = '80px';
					a2.style.marginTop = '10px';
					a2.id = 'shoujituku';
					document.getElementById("cloudstorage_0").appendChild(a2);
				}

				/**
				 * 增加档案
				 * @param {Object} data
				 */
				function addcloudstorage_0_1(data) {
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_dangan.png" />\
									   <p class="mui-ellipsis">' + data.StudentName + '档案</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '80px';
					a.style.marginTop = '10px';
					a.setAttribute('StudentId', data.StudentId); //学生ID
					a.setAttribute('StudentName', data.StudentName); //学生姓名
					document.getElementById("cloudstorage_0").appendChild(a);

				}

				/**
				 * 增加班级
				 */
				function addcloudrecord_1_0(data) {
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2-bg" src="' + updateHeadImg(data.gimg, 2) + '"/>\
									   <p class="mui-ellipsis">' + data.gname + '</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '60px';
					a.style.marginTop = '10px';
					document.getElementById("cloudrecord_1").appendChild(a);
				}

				/**
				 * 作业和班级管理
				 */
				function addcloudrecord_0_0() {
					//作业
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_zuoye.png" />\
									   <p class="mui-ellipsis">作业</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '60px';
					a.style.marginTop = '10px';
					a.setAttribute('value', 0);
					a.id = 'homework';
					document.getElementById("cloudrecord_0").appendChild(a);

					//班级管理
					var a2 = document.createElement('a');
					a2.className = 'mui-control-item';
					a2.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_banjiguanli.png" />\
									   <p class="mui-ellipsis">班级管理</p>';
					a2.style.width = maxWidth + 'px';
					a2.style.height = '60px';
					a2.style.marginTop = '10px';
					a2.setAttribute('value', 1);
					a2.id = 'manage';
					document.getElementById("cloudrecord_0").appendChild(a2);
				}

				/**
				 * 增加学生
				 */
				function addcloudrecord_0_1(data) {
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2-bg" src="' + updateHeadImg(data.gimg, 2) + '"/>\
									   <p class="mui-ellipsis">' + data.ugname + '</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '60px';
					a.style.marginTop = '10px';
					document.getElementById("cloudrecord_0").appendChild(a);
				}

				/**
				 * 增加笔记和记事
				 */
				function addcloudapps_0() {
					//笔记
					var a = document.createElement('a');
					a.className = 'mui-control-item';
					a.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_biji.png" />\
									   <p class="mui-ellipsis">笔记</p>';
					a.style.width = maxWidth + 'px';
					a.style.height = '80px';
					a.style.marginTop = '10px';
					a.setAttribute('value', 0);
					a.id = 'notes';
					document.getElementById("cloudapps_0").appendChild(a);

					//记事
					var a2 = document.createElement('a');
					a2.className = 'mui-control-item';
					a2.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_jishi.png" />\
									   <p class="mui-ellipsis">记事</p>';
					a2.style.width = maxWidth + 'px';
					a2.style.height = '80px';
					a2.style.marginTop = '10px';
					a2.setAttribute('value', 1);
					a2.id = 'note';
					document.getElementById("cloudapps_0").appendChild(a2);
				}

				//获取学生列表
				function getStuList() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//所需参数
					var comData = {
						utid: personalUTID
					};
					//返回值model：model_userDataInfo
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//24.通过用户表ID获取用户关联的学生
					postDataPro_PostUstu(comData, wd, function(data) {
						//清除学生区域
						document.getElementById("cloudrecord_0").innerHTML = '';
						addcloudrecord_0_0();
						console.log('获取学生列表_PostUstu:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0 || data.RspCode == 9 || data.RspCode == 7) { //9为查询记录为空
							topStudentArr = data.RspData;
							//生成学生界面
							mui.each(topStudentArr, function(index, element) {
								//console.log('学生:' + index + '|' + JSON.stringify(element));
								addcloudrecord_0_1(element);
							})
						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				//获取所有的群
				function getGroupList() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//	//需要参数
					var comData = {
						vtp: 'ag', //要获取的项:cg(创建的群),ug(参与群),mg(协管的群),ag(所有的群)
						vvl: personalUTID, //查询的各项，对应人的utid，可以是查询的任何人
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//	获取用户群
					postDataPro_PostGList(comData, wd, function(data) {
						//清除班级区域
						document.getElementById("cloudrecord_1").innerHTML = '';
						console.log('获取用户群_PostGList:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							//			showBlankPage(false);
							datasource = data.RspData; //底部列表数据
							var tempArr = [];
							var tempDatasource = [];
							//			群去重
							for(var i = 0; i < datasource.length; i++) {
								if(tempArr.indexOf(datasource[i].gid) > -1) {
									//					console.log(i+'已存在'+datasource[i].gid);
								} else {
									//					console.log(i+'不存在'+datasource[i].gid);
									tempArr.push(datasource[i].gid);
									tempDatasource.push(datasource[i]);
								}
							}
							datasource = tempDatasource;
							//生成班级界面
							mui.each(datasource, function(index, element) {
								//console.log('班级:' + index + '|' + JSON.stringify(element));
								addcloudrecord_1_0(element);
							});
						} else if(data.RspCode == 9) { //没有群
							console.log('显示空白页')
								//			showBlankPage(true); //显示空白页
						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}
			});
		</script>
	</body>

</html>