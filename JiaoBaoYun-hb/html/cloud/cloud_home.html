<!--
	作者：444811716@qq.com
	时间：2016-10-26
	描述：云盘主页
-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<link rel="stylesheet" href="../../css/iconfont/iconfont.css" />
		<link rel="stylesheet" href="../../css/cloud/file.css" />
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/cloud/cloud.js"></script>
		<script type="text/javascript" src="../../js/utils/h5fresh.js"></script>
		<style>
			.mui-table-view:before,
			.mui-table-view:after,
			.mui-table-view-cell:after {
				height: 0px;
			}

			.mui-table-view {
				/*background-color: white;*/
			}

			.cloud-item {
				background-color: white;
			}

			.cloud-item-left {
				width: 16%;
				border-right: 1px solid #D9D9D9;
				float: left;
				text-align: center;
				font-weight: bold;
				font-size: 1.6rem;
			}

			.cloud-item-right {
				/*margin-left: 16%;*/
				width: 84%;
				float: right;
			}

			#cloudstorage_0,
			#cloudrecord_0,
			#cloudapps_0 {
				/*每一项的第一行*/
				/*background-color: red;*/
			}

			#cloudstorage_1,
			#cloudrecord_1,
			#cloudapps_1 {
				/*每一项的第二行*/
				/*background-color: blue;*/
			}

			.mui-plus-pullrefresh .mui-scroll {
				position: absolute;
				/*width: 100%;*/
			}

			.mui-segmented-control.mui-segmented-control-inverted .mui-control-item.mui-active {
				color: black;
				border: none;
			}

			.mui-table-view-cell {
				display: inline-block;
				width: auto;
				padding: 1px 1px;
			}

			.mui-slider-indicator .mui-table-view-cell.mui-active {
				background: #D9D9D9;
			}

			.cloud-red-point {
				position: absolute;
				background: red;
			}

			img {
				border-radius: 50%;
			}

			#cloudstorage_1 img {
				border-radius: 0px;
			}
		</style>
	</head>

	<body>
		<div id="refreshContainer" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--存储-->
				<div id="cloudstorage" class="cloud-item">
					<div id="cloudstoragename" class="cloud-item-left">
						存<br/>储
					</div>
					<div class="cloud-item-right">
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="height: 100px;">
							<div id="cloudstorage_0" class="mui-scroll">
							</div>
						</div>
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<div id="cloudstorage_1" class="mui-scroll"></div>
						</div>
					</div>
				</div>
				<!--家校互动-->
				<div id="cloudrecord" class="cloud-item">
					<div class="cloud-item-left">
						家<br />校<br />互<br />动
					</div>
					<div class="cloud-item-right">
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<div id="cloudrecord_0" class="mui-scroll"></div>
						</div>
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<div id="cloudrecord_1" class="mui-scroll"></div>
						</div>
					</div>
				</div>
				<!--应用-->
				<div id="cloudapps" class="cloud-item">
					<font class="cloud-item-left" style="">
						应<br/>用
					</font>
					<div class="cloud-item-right mui-table-view">
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<div id="cloudapps_0" class="mui-scroll">
							</div>
						</div>
						<div class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
							<div id="cloudapps_1" class="mui-scroll">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			mui.init();

			//声明变量
			//文件存储数组
			var fileArray = [];
			//获取所有的群
			var datasource = [];
			//获取学生列表
			var topStudentArr = [];
			//每一行的高度
			var cloudItemHeight = 0;
			//第一行和第三行的比重
			var cloudFirst = 3;
			//第二行的比重
			var cloudSecond = 3;
			//第三行的比重
			var cloudThird = 3;
			//第一项的高度
			var cloudFirstItemHeight = 0;
			//第二项的高度
			var cloudSecondItemHeight = 0;
			//第三项的高度
			var cloudThirdItemHeight = 0;
			//每个图标的宽度
			var maxWidth = 0;
			//每个图标中图标图片的宽度
			var imgeWith = 0.6;
			mui.plusReady(function() {
				events.preload("../homework/homework-tea.html", 300);
				events.preload('storage_main.html'); //预加载云存储
				events.preload('storage_upload.html'); //预加载上传文件选择
				events.preload('storage_upload_choose.html'); //预加载选择上传文件的方式

				//下拉刷新
				h5fresh.addRefresh(function() {
					console.log('下拉刷新');
					events.fireToPageNone('../index/index.html', 'aboutmNoRead');
					//文件存储数组
					fileArray = [];
					//获取所有的群
					datasource = [];
					//获取学生列表
					topStudentArr = [];
					changeData();
				});

				//---调整界面---start---

				//屏幕宽度
				var screenWidth = plus.screen.resolutionWidth;
				//webview高度
				var webHeight = plus.screen.resolutionHeight - (plus.navigator.getStatusbarHeight() + 45 + 50);
				//console.log('webHeight:' + webHeight);
				//每一行的高度
				cloudItemHeight = (webHeight * 1 - (webHeight * 0.015 * 4)) / (cloudFirst + cloudSecond + cloudThird);
				//左侧文字宽度
				var nameWidth = document.getElementById("cloudstoragename").offsetWidth;
				//console.log('nameWidth:' + nameWidth);
				//每个图标的宽度
				maxWidth = (screenWidth * 1 - nameWidth * 1 - 5) / 4.5;
				console.log('maxWidth:' + maxWidth);
				mui('.cloud-item').each(function(index, element) {
					var sliderHeight = 0;
					if(element.id == 'cloudrecord') { //家校互动
						element.style.height = (cloudItemHeight * cloudSecond) + 'px';
						cloudSecondItemHeight = element.offsetHeight;
						sliderHeight = cloudSecondItemHeight;
					} else if(element.id == 'cloudstorage') {
						element.style.height = (cloudItemHeight * cloudFirst) + 'px';
						cloudFirstItemHeight = element.offsetHeight;
						sliderHeight = cloudFirstItemHeight;
					} else if(element.id == 'cloudapps') {
						element.style.height = (cloudItemHeight * cloudThird) + 'px';
						cloudThirdItemHeight = element.offsetHeight;
						sliderHeight = cloudThirdItemHeight;
					}
					element.style.marginTop = (webHeight * 0.015) + 'px';
					element.style.marginBottom = (webHeight * 0.015) + 'px';

					//每一项左侧的文字垂直居中
					element.firstElementChild.style.marginTop = (element.offsetHeight - element.firstElementChild.offsetHeight) / 2 + 'px';
					//设置右侧左右滑动的高度
					//					if(element.id == 'cloudapps') {
					//						element.lastElementChild.firstElementChild.style.height = sliderHeight + 'px';
					//						element.lastElementChild.lastElementChild.style.height = 0 + 'px';
					//						element.lastElementChild.firstElementChild.firstElementChild.style.height = sliderHeight + 'px';
					//						element.lastElementChild.lastElementChild.firstElementChild.style.height = 0 + 'px';
					//					} else {
					element.lastElementChild.firstElementChild.style.height = sliderHeight / 2 + 'px';
					element.lastElementChild.lastElementChild.style.height = sliderHeight / 2 + 'px';
					element.lastElementChild.firstElementChild.firstElementChild.style.height = sliderHeight / 2 + 'px';
					element.lastElementChild.lastElementChild.firstElementChild.style.height = sliderHeight / 2 + 'px';
					//}
				});

				//---调整界面---end---

				//-----------设置数据start---------------
				addcloudapps_0(); //应用
				changeData();
				//-----------设置数据end---------------

				//重新登录或者自动登录后获取的信息
				window.addEventListener('infoChanged', function() {
					//文件存储数组
					fileArray = [];
					//获取所有的群
					datasource = [];
					//获取学生列表
					topStudentArr = [];
					changeData();
					events.fireToPageNone('storage_upload.html', 'createFolder'); //在程序中创建utid的文件夹和对应的上传下载文件夹
				});

				//修改用户信息
				window.addEventListener('stuImgeChanged', function(e) {
					//设置页面信息
					var data = e.detail;
					console.log(JSON.stringify(data));
					document.getElementById("student_imge_" + data.id).src = data.img;
				});

				//修改云存储信息
				window.addEventListener('cloudDataChange', function() {
					//设置页面信息
					changeCloudData();
				});

				//-----------设置数据end-----------------

				//-----------设置监听start---------------

				//---云盘start---
				//云盘第一行
				mui('#cloudstorage_0').on('tap', '.mui-table-view-cell', function() {
					var id = this.id;
					if(id == 'shoujitongxunlu') { //手机通讯录
						mui.toast('手机通讯录功能暂未开放');
					} else if(id == 'shoujituku') { //手机图库
						mui.toast('手机图库功能暂未开放');
					} else { //档案
						events.openNewWindowWithData('record_student_main.html', {
							StudentId: this.getAttribute('StudentId'), //学生ID
							StudentName: this.getAttribute('StudentName') //学生姓名
						});
					}
				});

				//云存储显示的文件
				mui('#cloudstorage_1').on('tap', '.mui-table-view-cell', function() {
					if(this.id != 'addFolder') {
						events.fireToPageWithData('storage_main.html', 'init', {
							fid: '0', //文件id,顶层0
							showTop: true, //是否显示顶部的上传，传输列表，文件夹，如果是选择云盘上的文件夹则为false
							title: '云盘—云存储', //标题名
							top: fileArray //顶层文件和文件夹的数据
						});
					}
				});

				//增加文件夹
				mui('#cloudstorage').on('tap', '#addFolder', function(e) {
					e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
					var btnArray = ['取消', '确定'];
					mui.prompt('请输入新文件夹的名称：', '新文件夹', '新建文件夹', btnArray, function(e) {
						if(e.index == 1) { //点击确定
							var reg = new RegExp('^[^\\\\\\/:*?\\"<>|]+$'); //特殊字符过滤的正则表达式
							if(e.value.replace(/(^\s*)|(\s*$)/g, "") == "") {
								mui.toast('文件夹名字不能为空');
							} else if(!reg.test(e.value)) {
								//特殊字符
								mui.toast('名字中不能包含这些字符 \ / : * ? " < > | ');
							} else {
								//27.用户云盘文件上传或创建文件夹
								//所需参数
								var comData = {
									pid: '0', //	父ID，该文件的上层ID
									fname: e.value, //	文件名称，文件或文件夹名称,文件存扩展名之前的名称
									ftype: '.file', //	文件类型，存文件的扩展名,如.file为文件夹
									fpath: '', //	文件路径，文件路径,为文件用
									fsize: '0' //	文件大小，文件用
								};
								// 等待的对话框
								var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
								postDataPro_PostDiFiA(comData, wd, function(data) {
									wd.close();
									console.log('27.postDataPro_PostDiFiA:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
									if(data.RspCode == 0) {
										//26.用户云盘顶层文件及文件夹获取
										postFirstFile();
										mui.toast('创建成功');
										mui.closePopups();
									} else if(data.RspCode == 8) {
										mui.toast('操作失败！已存在相同的名字');
									} else {
										mui.toast(data.RspTxt);
									}
								});
							}
							return false;
						} else {
							//点击取消
						}
					}, 'div');
					document.querySelector('.mui-popup-input input').type = 'text';
					document.querySelector('.mui-popup-input input').maxLength = '20';
				});

				//---云盘end---

				//---家校互动---start---
				mui('#cloudrecord_0').on('tap', '.mui-table-view-cell', function() {
					var id = this.id;
					if(id == 'homework') { //作业
						requestClassData();
					} else if(id == 'manage') { //班级管理
						events.openNewWindowWithData('/html/mine/qun_manage_main.html', {
							type: '1' //0群管理,1人员资料
						});
						//events.openNewWindow('/html/mine/qun_manage.html');
					} else { //学生
						console.log('学生');
						var index = this.id.replace('studentsdynamic', '');
						console.log('studentsdynamic====' + index)
						mui.openWindow({
							url: '../quan/studentdynamic_main.html',
							id: '../quan/studentdynamic_main.html',
							styles: {
								top: '0px', //设置距离顶部的距离
								bottom: '0px'
							},
							extras: {
								data: {
									studentId: topStudentArr[index].stuid,
									classId: topStudentArr[index].gid,
									studentName: topStudentArr[index].stuname,
									stuimg: topStudentArr[index].stuimg
								}
							},
						});
					}
				});

				mui('#cloudrecord_1').on('tap', '.mui-table-view-cell', function() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					var id = this.id;
					if(id == 'noclass') { //没有班级的情况
						events.openNewWindow('../mine/qun_manage_info.html');
					} else { //班级
						var type = this.getAttribute('type');
						if(type == 0) {
							console.log('班级');
							var index = this.id.replace('tarClass', '');
							console.log('index：' + index)
							mui.openWindow({
								url: '../quan/class_space.html',
								id: '../quan/class_space.html',
								styles: {
									top: '0px', //设置距离顶部的距离
									bottom: '0px'
								},
								extras: {
									data: {
										userId: personalUTID,
										classId: datasource[index].gid
									},
									className: datasource[index].gname
								},
							});
						} else {
							console.log('家校圈');
							var index = this.id.replace('tarClass1', '');
							console.log('index：' + index)
							mui.openWindow({
								url: '../quan/parentZone.html',
								id: '../quan/parentZone.html',
								styles: {
									top: '0px', //设置距离顶部的距离
									bottom: '0px'
								},
								extras: {
									data: {
										className: datasource[index].gname,
										classId: datasource[index].gid
									}
								},
							});
						}
					}
				});
				//---家校互动---end---

				//---应用---start---
				mui('#cloudapps').on('tap', '.mui-table-view-cell', function() {
					var value = this.getAttribute("value");
					switch(value) {
						case "0": //笔记
							events.openNewWindow('app_notes_main.html');
							break;
						case "1": //记事
							events.openNewWindow('app_keeprecord.html');
							break;
					}
				});
				//---应用---end---

				//-----------设置监听end---------------

				/**
				 * 修改云盘的文件，档案数据
				 */
				function changeData() {
					document.getElementById("cloudstorage_0").innerHTML = '';
					document.getElementById("cloudstorage_1").innerHTML = '';
					//26.用户云盘顶层文件及文件夹获取
					postFirstFile();
					//73.（云档案）按家长获取学生档案姓名
					postUserStudent();
					//获取学生
					getStuList();
					//获取班级
					getGroupList();
				}

				/**
				 * 修改云盘的文件
				 */
				function changeCloudData() {
					document.getElementById("cloudstorage_1").innerHTML = '';
					//26.用户云盘顶层文件及文件夹获取
					postFirstFile();
				}

				/**
				 * 获取用户所在群数据
				 */
				function requestClassData() {
					var teacherClasses = [];
					var studentClasses = [];
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//获取当前账号，所在的群
					//需要参数
					var comData = {
						vtp: 'ag', //要获取的项:cg(创建的群),ug(参与群),mg(协管的群),ag(所有的群),ig(群信息vvl对应群ID)
						vvl: personalUTID //查询的各项，对应人的utid，可以是查询的任何人
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//9.获取用户群
					postDataPro_PostGList(comData, wd, function(data) {
						wd.close();
						console.log('作业主界面获取的群信息：' + JSON.stringify(data));
						if(data.RspCode == 0) {
							var tempArray = data.RspData;
							//			gid:'14',//群ID
							//			gname:'10群',//群名
							//			gimg:'',//群头像,群头像的链接
							//			mstype:'2'//用户角色,0家长,1管理员,2老师,3学生
							//然后检索身份为老师或者家长、学生的
							for(var i in tempArray) {
								var tempModel = tempArray[i];

								var isHave = false;
								//2老师
								if(tempModel.mstype == 2 || tempModel.mstype == 1) {
									for(var m in teacherClasses) {
										if(tempModel.gid == teacherClasses[m].gid) {
											isHave = true;
											break;
										}
									}
									if(!isHave) {
										teacherClasses.push(tempModel);
									}
								}
								var isHave1 = false;
								//家长、学生
								if(tempModel.mstype == 0 || tempModel.mstype == 3) {
									for(var m in studentClasses) {
										if(tempModel.gid == studentClasses[m].gid) {
											isHave1 = true;
											break;
										}
									}
									if(!isHave1) {
										studentClasses.push(tempModel);
									}
								}
							}
							if(teacherClasses.length > 0 || studentClasses.length > 0) {
								console.log('teacherClasses:' + teacherClasses.length + ',' + studentClasses.length);
								events.fireToPageWithData('../homework/homework-tea.html', 'postClasses', {
									teacherClasses: teacherClasses,
									studentClasses: studentClasses
								})
							} else {
								mui.toast('您还未加入班级');
							}
						} else {
							mui.toast(data.RspTxt);
						}
					});
				}

				//26.用户云盘顶层文件及文件夹获取
				function postFirstFile() {
					//所需参数
					var comData = {
						vvl: '0' //	节点ID，顶层为0
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_PostDiFi(comData, wd, function(data) {
						document.getElementById("cloudstorage_1").innerHTML = '';;
						addStorageIcon();
						console.log('26.postDataPro_PostDiFi_用户云盘顶层文件及文件夹获取_RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							//给存储数组赋值
							if(data.RspData != null && data.RspData != '') {
								fileArray = data.RspData;
							} else {
								fileArray = [];
							}
							//清掉所有文件夹
							document.getElementById("cloudstorage_1").innerHTML = '';;
							//循环将获取到的值塞入界面
							var folder = 0;
							mui.each(data.RspData, function(index, element) {
								//								if(folder == 4) {
								//									return false;
								//								}
								if(element.ftype == '.file') {
									folder++;
									addStorageFolder(element);
								}
							});
							//if(folder < 4) {
							mui.each(data.RspData, function(index, element) {
								//									if(folder == 4) {
								//										return false;
								//									}
								if(element.ftype != '.file') {
									folder++;
									addStorageFolder(element);
								}
							});
							//}
							//增加加号
							//if(fileArray.length < 4) {
							addStorageIcon();
							//}
						} else if(data.RspCode == 9) {

						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				//73.（云档案）按家长获取学生档案姓名
				function postUserStudent() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//73.（云档案）按家长获取学生档案姓名
					//所需参数
					var comData = {
						parentId: personalUTID //家长ID
					};
					//返回学生姓名数组
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_getStudentName(comData, wd, function(data) {
						console.log('73.云档案）按家长获取学生档案姓名postDataPro_getStudentName:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						document.getElementById("cloudstorage_0").innerHTML = '';
						addcloudstorage_0_0(); //手机通讯录，手机图库
						if(data.RspCode == 0) {
							//设置页面显示
							mui.each(data.RspData.Students, function(index, item) {
								//console.log('学生档案：' + index + '|' + JSON.stringify(item));
								addcloudstorage_0_1(item);
							});
						} else if(data.RspCode == 9) {} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				/**
				 * 增加存储的文件夹或文件
				 * @param {Object} data
				 */
				function addStorageFolder(data) {
					var li = document.createElement("li");
					li.setAttribute('data-fid', data.fid);
					li.className = 'mui-table-view-cell';
					var html1 = ''; //图标
					var html2 = ''; //名字
					if(data.ftype == '.file') { //文件夹
						html1 = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_wenjianjia.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>';
						html2 = '<p class="mui-ellipsis">' + data.fname + '</p>';
					} else { //文件
						var type = cloud.classify(data.ftype);
						var pathList = data.fpath.split('/');
						var pathList2 = pathList[pathList.length - 1].split('.');
						var fileName = pathList2[0];
						var path = window.storageKeyName.QNFILEIMGEDOMAIN + fileName + '.PNG';
						if(type != '') {
							html1 = '<span class="mui-icon iconfont ' + type + '" style="border:none;font-size:' + (maxWidth * imgeWith) + 'px;"></span>';
						} else { //七牛能生成缩略图的图片或视频
							html1 = '<img src="' + path + '" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>';
						}
						html2 = '<p class="mui-ellipsis">' + data.fname + data.ftype + '</p>';
					}
					li.innerHTML = html1 + html2;
					li.style.width = maxWidth + 'px';
					li.style.height = cloudFirstItemHeight + 'px';
					document.getElementById("cloudstorage_1").appendChild(li);
					li.style.paddingTop = (cloudFirstItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';
				}

				/**
				 * 增加文件夹的按钮（加号按钮）
				 */
				function addStorageIcon() {
					var li = document.createElement('li');
					li.id = 'addFolder';
					li.className = 'mui-table-view-cell';
					li.innerHTML = '<img class="cloud-bottom-imge2" src="../../image/cloud/cloud_0_xinjian.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/><p class="mui-ellipsis">新建文件夹</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudFirstItemHeight + 'px';
					document.getElementById("cloudstorage_1").appendChild(li);
					li.style.paddingTop = (cloudFirstItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';
				}

				/**
				 * 增加手机通讯录和手机图库
				 */
				function addcloudstorage_0_0() {
					//手机通讯录
					var li = document.createElement('li');
					li.id = 'shoujitongxunlu';
					li.className = 'mui-table-view-cell';
					li.innerHTML = '<img src="../../image/cloud/cloud_0_tongxunlu.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">手机通讯录</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudFirstItemHeight / 2 + 'px';
					document.getElementById("cloudstorage_0").appendChild(li);
					li.style.paddingTop = (cloudFirstItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';

					//手机图库
					var li2 = document.createElement('li');
					li2.id = 'shoujituku';
					li2.className = 'mui-table-view-cell';
					li2.innerHTML = '<img src="../../image/cloud/cloud_0_tuku.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">手机图库</p>';
					li2.style.width = maxWidth + 'px';
					li2.style.height = cloudFirstItemHeight / 2 + 'px';
					document.getElementById("cloudstorage_0").appendChild(li2);
					li2.style.paddingTop = (cloudFirstItemHeight / 2 - (li2.lastElementChild.offsetHeight + li2.lastElementChild.offsetTop - li2.firstElementChild.offsetTop)) / 2 + 'px';

				}

				/**
				 * 增加档案
				 * @param {Object} data
				 */
				function addcloudstorage_0_1(data) {
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.setAttribute('StudentId', data.StudentId); //学生ID
					li.setAttribute('StudentName', data.StudentName); //学生姓名
					li.innerHTML = '<img src="../../image/cloud/cloud_0_dangan.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">' + data.StudentName + '档案</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudFirstItemHeight / 2 + 'px';
					document.getElementById("cloudstorage_0").appendChild(li);
					li.style.paddingTop = (cloudFirstItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';
				}

				/**
				 * 作业和人员资料
				 */
				function addcloudrecord_0_0() {
					//作业
					var li = document.createElement('li');
					li.id = 'homework';
					li.className = 'mui-table-view-cell';
					li.setAttribute('value', 0);
					li.innerHTML = '<img src="../../image/cloud/cloud_0_zuoye.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">作业</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudSecondItemHeight / 2 + 'px';
					document.getElementById("cloudrecord_0").appendChild(li);
					li.style.paddingTop = (cloudSecondItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';

					//人员资料
					var li2 = document.createElement('li');
					li2.id = 'manage';
					li2.className = 'mui-table-view-cell';
					li2.setAttribute('value', 1);
					li2.innerHTML = '<img src="../../image/cloud/cloud_0_banjiguanli.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">人员资料</p>';
					li2.style.width = maxWidth + 'px';
					li2.style.height = cloudSecondItemHeight / 2 + 'px';
					document.getElementById("cloudrecord_0").appendChild(li2);
					li2.style.paddingTop = (cloudSecondItemHeight / 2 - (li2.lastElementChild.offsetHeight + li2.lastElementChild.offsetTop - li2.firstElementChild.offsetTop)) / 2 + 'px';
				}

				/**
				 * 增加学生
				 */
				function addcloudrecord_0_1(id_index, data) {
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.id = 'studentsdynamic' + id_index
					var html0 = '<div class="cloud-red-point" style="margin-left:' + (maxWidth / 1.5) + 'px' + ';height:' + (maxWidth / 7) + 'px;width:' + (maxWidth / 7) + 'px;border-radius: 50%;"></div>';
					li.innerHTML = html0 + '<img id="student_imge_' + data.stuid + '" src="' + updateHeadImg(data.stuimg, 2) + '"style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">' + data.stuname + '</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudSecondItemHeight / 2 + 'px';
					document.getElementById("cloudrecord_0").appendChild(li);
					li.style.paddingTop = (cloudSecondItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.querySelector('img').offsetTop)) / 2 + 'px';
				}

				/**
				 * 增加班级,家校圈入口
				 * @param {Object} data
				 * @param {Object} type 班级0,家校圈1
				 */
				function addcloudrecord_1_0(id_index, data, type) {
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell';
					li.setAttribute('type', type);
					var html0 = '<div class="cloud-red-point" style="margin-left:' + (maxWidth / 1.5) + 'px;height:' + (maxWidth / 7) + 'px;width:' + (maxWidth / 7) + 'px;border-radius: 50%;"></div>';
					var html1 = '';
					if(type == 0) {
						li.id = 'tarClass' + id_index;
						html1 = html0 + '<img src="../../image/cloud/cloud_0_class.png" style="margin-left:' + (maxWidth / 2.5) + 'px;position: absolute;margin-top: ' + (maxWidth * 0.3) + 'px;"/>';
						li.innerHTML = html1 + '<img src="' + updateHeadImg(data.gimg, 2) + '"style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">' + data.gname + '</p>';
					} else {
						li.id = 'tarClass1' + id_index;
						html1 = html0 + '<img  src="../../image/cloud/cloud_0_zone.png" style="margin-left:' + (maxWidth / 2.5) + 'px' + ';position: absolute;margin-top: ' + (maxWidth * 0.3) + 'px;"/>';
						li.innerHTML = html1 + '<img src="' + updateHeadImg(data.gimg, 2) + '"style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">家长(' + data.gname + ')</p>';
					}

					li.style.width = maxWidth + 'px';
					li.style.height = cloudSecondItemHeight + 'px';
					document.getElementById("cloudrecord_1").appendChild(li);
					li.style.paddingTop = (cloudSecondItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.querySelectorAll('img')[1].offsetTop)) / 2 + 'px';
				}

				/**
				 * 没有班级的情况
				 */
				function addcloudrecord_1_noclass() {
					var li = document.createElement('li');
					li.id = 'noclass';
					li.className = 'mui-table-view-cell';
					li.innerHTML = '<img src="../../image/quan/add.png"style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">创建班级</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudSecondItemHeight + 'px';
					document.getElementById("cloudrecord_1").appendChild(li);
					li.style.paddingTop = (cloudSecondItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px';
				}

				/**
				 * 增加笔记和记事
				 */
				function addcloudapps_0() {
					//笔记
					var li = document.createElement('li');
					li.id = 'notes';
					li.className = 'mui-table-view-cell';
					li.setAttribute('value', 0);
					li.innerHTML = '<img src="../../image/cloud/cloud_0_biji.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">笔记</p>';
					li.style.width = maxWidth + 'px';
					li.style.height = cloudThirdItemHeight / 2 + 'px';
					document.getElementById("cloudapps_0").appendChild(li);
					li.style.paddingTop = (cloudThirdItemHeight / 2 - (li.lastElementChild.offsetHeight + li.lastElementChild.offsetTop - li.firstElementChild.offsetTop)) / 2 + 'px'; //笔记

					var li2 = document.createElement('li');
					li2.id = 'note';
					li2.className = 'mui-table-view-cell';
					li2.setAttribute('value', 1);
					li2.innerHTML = '<img src="../../image/cloud/cloud_0_jishi.png" style="height: ' + (maxWidth * imgeWith) + 'px;width: ' + (maxWidth * imgeWith) + 'px;"/>\
									   <p class="mui-ellipsis">记事</p>';
					li2.style.width = maxWidth + 'px';
					li2.style.height = cloudThirdItemHeight / 2 + 'px';
					document.getElementById("cloudapps_0").appendChild(li2);
					li2.style.paddingTop = (cloudThirdItemHeight / 2 - (li2.lastElementChild.offsetHeight + li2.lastElementChild.offsetTop - li2.firstElementChild.offsetTop)) / 2 + 'px'; //记事
				}

				//获取学生列表
				function getStuList() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//所需参数
					var comData = {
						utid: personalUTID
					};
					//返回值model：model_userDataInfo
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//24.通过用户表ID获取用户关联的学生
					postDataPro_PostUstu(comData, wd, function(data) {
						//清除学生区域
						document.getElementById("cloudrecord_0").innerHTML = '';
						addcloudrecord_0_0();
						console.log('获取学生列表_PostUstu:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0 || data.RspCode == 9 || data.RspCode == 7) { //9为查询记录为空
							topStudentArr = data.RspData;
							//生成学生界面
							mui.each(topStudentArr, function(index, element) {
								console.log('学生:' + index + '|' + JSON.stringify(element));
								addcloudrecord_0_1(index, element);
							});
						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				//获取所有的群
				function getGroupList() {
					var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;
					//	//需要参数
					var comData = {
						vtp: 'ag', //要获取的项:cg(创建的群),ug(参与群),mg(协管的群),ag(所有的群)
						vvl: personalUTID, //查询的各项，对应人的utid，可以是查询的任何人
					};
					// 等待的对话框
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					//	获取用户群
					postDataPro_PostGList(comData, wd, function(data) {
						//清除班级区域
						document.getElementById("cloudrecord_1").innerHTML = '';
						console.log('获取用户群_PostGList:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							//			showBlankPage(false);
							datasource = data.RspData; //底部列表数据
							var tempArr = [];
							var tempDatasource = [];
							//			群去重
							for(var i = 0; i < datasource.length; i++) {
								if(tempArr.indexOf(datasource[i].gid) > -1) {
									//					console.log(i+'已存在'+datasource[i].gid);
								} else {
									//					console.log(i+'不存在'+datasource[i].gid);
									tempArr.push(datasource[i].gid);
									tempDatasource.push(datasource[i]);
								}
							}
							datasource = tempDatasource;
							//生成班级界面
							mui.each(datasource, function(index, element) {
								//console.log('班级:' + index + '|' + JSON.stringify(element));
								addcloudrecord_1_0(index, element, 0);
							});
							//生成家校圈界面
							mui.each(datasource, function(index, element) {
								//console.log('家校圈:' + index + '|' + JSON.stringify(element));
								addcloudrecord_1_0(index, element, 1);
							});
						} else if(data.RspCode == 9) { //没有群
							console.log('显示空白页');
							addcloudrecord_1_noclass();
							//			showBlankPage(true); //显示空白页
						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}
			});
		</script>
	</body>

</html>