<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<link rel="stylesheet" href="../../css/iconfont/iconfont.css" />
		<link rel="stylesheet" href="../../css/utils/MultiMedia.css" />
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<script type="text/javascript" src="../../js/utils/MultiMedia.js"></script>

		<style type="text/css">
			body,
			.mui-content {
				background: white;
			}

			textarea {
				height: 100%;
				width: 100%;
				margin-bottom: 0;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="color: white;">笔记</h1>
			<h1 id="finish" class="mui-title" style="text-align: right;right: 10px;">完成</h1>
		</header>
		<nav class="mui-bar mui-bar-tab" style="box-shadow: none;">
			<div id="MultiMedia">
			</div>
		</nav>
		<div class="mui-content">
			<textarea id="notes" oninput="if(value.length>2000)value=value.slice(0,2000)" placeholder="✎ 分享你的学习与生活..." style="border: none;"></textarea>
		</div>

		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				var self = plus.webview.currentWebview();
//				self.setStyle({
//					softinputMode:'adjustResize'
//				});
				var notes = document.getElementById("notes");
				var height = plus.screen.resolutionHeight - (localStorage.getItem('StatusHeightNo') * 1 + 75 + 50); //屏幕高度-状态栏高度-顶部导航高度

				notes.style.height = height + 'px';

				MultiMedia.addElement(document.getElementById("MultiMedia"));

				document.getElementById('finish').addEventListener('tap', function() {

					if(notes.value.replace(/(^\s*)|(\s*$)/g, "") == "") { //为空不允许发送
						mui.toast('请输入文字');
					} else {
						document.getElementById("finish").disabled = true;
						var userId = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid;

						//38.（用户空间）新增某用户空间信息 （云笔记）
						//所需参数
						var comData = {
							userId: userId, //用户ID
							msgContent: notes.value, //记事内容
							encType: '3', //附件类型，1图片2音视频3仅文字
							encAddr: '', //附件地址
							encImg: '', //附件缩略图地址
							encIntro: '', //附件简介
							noteType: '1', //信息类型,1云笔记2个人空间
							userIds: '[]', //推送用户ID
							pubScopes: '[1]', //1 家校圈 必选,2 展现 可选例如[1,2]
							pubArea: '' //具体到市级代码
						};
						//非0为正确
						// 等待的对话框
						var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
						postDataPro_addUserSpace(comData, wd, function(data) {
							wd.close();
							console.log('38postDataPro_addUserSpace（用户空间）新增某用户空间信息 （云笔记）.90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
							if(data.RspCode == 0) {
								mui.toast('发布成功');
								events.fireToPageNone('app_notes_sub.html', 'refreshView');
								mui.back();
							} else {
								if(data.RspCode != 9) {
									mui.toast(data.RspTxt);
								}
								document.getElementById("finish").disabled = false;
							}
						});
					}
				})
			})
		</script>
	</body>

</html>