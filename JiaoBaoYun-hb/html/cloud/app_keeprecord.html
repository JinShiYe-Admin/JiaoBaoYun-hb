<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<link rel="stylesheet" href="../../css/iconfont/iconfont.css" />
		<script src="../../js/mui.min.js"></script>
		<style>
			.mui-table-view:before,
			.mui-table-view:after,
			.mui-table-view-cell:after {
				height: 0px;
			}

			.mui-fullscreen {
				background-color: white;
			}

			.keep-noclass {
				/*无班级*/
				text-align: center;
				margin-top: 20px;
			}

			.mui-slider .mui-segmented-control.mui-segmented-control-inverted~ .mui-slider-group .mui-slider-item {
				border-top: 0px solid #c8c7cc;
				border-bottom: 0px solid #c8c7cc;
			}

			.mui-segmented-control.mui-scroll-wrapper .mui-control-item {
				padding-left: 10px;
				padding-right: 10px;
			}

			#sliderSegmentedControl {
				margin-top: 10px;
				background-color: #F2F2F2;
				margin-left: 5px;
			}

			.keep-line-blue {
				position: absolute;
				height: 38px;
				width: 5px;
				top: 54px;
				background-color: #64A1EB;
				z-index: 999;
			}

			.mui-table-view-cell {
				padding: 10px 10px;
			}

			.keep-member {
				text-align: center;
				height: 75px;
			}

			.keep-member img {
				border-radius: 50%;
				height: 40px;
				width: 40px;
				max-width: 40px;
			}

			.keep-box-shadow-border {
				box-shadow: 1px 1px 1px #888888;
				border: 1px solid #F2F2F2;
				padding: 3px;
			}

			.addclass {
				/*添加班级的元素*/
			}

			.addmember {
				/*添加成员的元素*/
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<p class="mui-title common-color-white" style="text-align: left;">云盘—记事</p>
			<a class="mui-icon mui-icon-plus mui-pull-right"></a>
			<a class="mui-icon iconfont icon-links mui-pull-right" style="margin-right: 5px;margin-top: 2px;"></a>
		</header>
		<div class="mui-content">
			<div class="mui-popover" style="width: 100%;top: 150px;height: 200px;">
				<ul class="mui-table-view">
					<img id="closepop" src="../../image/cloud/record_addclassclose.png" style="height: 30px;float: right;margin: 10px;" />
					<input id="inputclassname" type="text" class="mui-input-clear" placeholder="请输入班级名称" style="width:80% ;margin-left: 10%;text-align: center;border-radius: 50px;">
					<button id="createclass" type="button" class="mui-btn mui-btn-blue mui-btn-block" style="border-radius: 50px;height: 40px;width: 80%;left: 10%;padding: 0;">创建</button>
				</ul>
			</div>
			<div id="noclass" class="keep-noclass" style="display: none;">
				<h5>现在没有班级请点击一下按钮创建班级</h5>
				<div>
					<img class="addclass" src="../../image/cloud/record_addclass.gif" />
				</div>
			</div>
			<div id="line" class="keep-line-blue" style="display: none;"></div>
			<div id="slider" class="mui-slider mui-fullscreen" style="display: none;">
				<div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted">
					<div id="classlist" class="mui-scroll">
						<!--<a class="mui-control-item" href="#1001班">
							1001班
						</a>
						<a class="mui-control-item" href="#1002班">
							1002班
						</a>-->
						<a id="controladd" class="mui-control-item" style="width: 40px;">
						</a>
						<div class="mui-icon mui-icon-plus addclass addclass-icon" style="position: absolute;border: 0px solid #ddd;font-size: 25px;color: #C7C7CC;right: 0px;"></div>
					</div>
				</div>
				<div id="classmemberlist" class="mui-slider-group">
					<!--<div id="1001班" class="mui-slider-item mui-control-content mui-active">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<div class="mui-row" style="margin-top: 8px;">
										<li id="addmember_1001班"class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3 ">
											<div class="keep-box-shadow-border keep-member addmember"data-id="1001班">
												<img src="../../image/cloud/record_add.png" style="height: 30px;width: 30px;margin-top: 18px;" />
											</div>
										</li>
									</div>
								</ul>
							</div>
						</div>
					</div>
					<div id="1002班" class="mui-slider-item mui-control-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<ul class="mui-table-view">
									<div class="mui-row" style="margin-top: 8px;">
										<li class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">
											<div class="keep-box-shadow-border keep-member">
												<img src="../../image/quan/u108.jpg" />
												<p class="mui-ellipsis">李伟</p>
											</div>
										</li>
										<li id="addmember_1002班" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3 ">
											<div class="keep-box-shadow-border keep-member addmember"data-id="1002班">
												<img src="../../image/cloud/record_add.png" style="height: 30px;width: 30px;margin-top: 18px;" />
											</div>
										</li>
									</div>
								</ul>
							</div>
						</div>
					</div>-->
				</div>
			</div>
		</div>
	</body>

	<script type="text/javascript">
		mui.init();
		mui.plusReady(function() {
			var classNameList = []; //记录所有班级的名称
			var content = document.body.querySelector('.mui-content');
			var classlist = document.getElementById("classlist"); //班级栏
			var controladd = document.getElementById("controladd"); //班级栏添加班级按钮前一个item
			var classmemberlist = document.getElementById("classmemberlist"); //成员列表
			classNameList = ['123', '321'];
			if(classNameList.length == 0) {
				//没有班级
				document.getElementById("noclass").style.display = 'inline';
				document.getElementById("noclass").style.textAlign = "center";
			} else {
				//有班级
				document.getElementById("line").style.display = 'inline';
				document.getElementById("slider").style.display = 'inline';
				mui.each(classNameList, function(index, item) {
					addClass(item);
				});
			}

			//---创建班级popover---start---
			//关闭创建班级界面
			document.getElementById('closepop').addEventListener('tap', function() {
				mui('.mui-popover').popover('hide');
			});

			//创建班级
			document.getElementById('createclass').addEventListener('tap', function() {
				var inputclass = document.getElementById("inputclassname");
				var name = inputclass.value; //创建的班级名称
				if(name == '') {
					mui.toast('不允许为空');
				} else {
					//发送数据并获得成功创建的回调后
					if(classNameList.length == 0) {
						//移除没有班级的界面
						document.getElementById("noclass").style.display = 'none';
						document.getElementById("line").style.display = 'inline';
						document.getElementById("slider").style.display = 'inline';
					}
					classNameList.push(name);
					addClass(name);
					mui('.mui-popover').popover('hide');
					inputclass.value = '';
				}

			});
			//---创建班级popover---end---

			//所有的添加班级按钮监听
			mui('.mui-content').on('tap', '.addclass', function() {
				mui('.mui-popover').popover('show');
			});

			//监听添加成员按钮班级
			mui('.mui-content').on('tap', '.addmember', function(e) {
				var id = this.getAttribute('data-id');
				var addid = 'addmember_' + id;
				var addTable = document.getElementById(addid);
				e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
				var btnArray = ['取消', '确定'];
				mui.prompt('请输入添加的新成员：', '添加新成员', '新成员', btnArray, function(e) {
					if(e.index == 1) {
						//点击确定
						if(e.value == '') {
							mui.toast('不能为空');
						} else {
							//向服务器发送数据并获得成功的回调
							var classTable = document.getElementById(id).querySelector('.mui-row');
							addMember(classTable, addTable, e.value);
						}
					} else {
						//点击取消
					}
				});
			});

			/**
			 * 班级栏添加一个班级，对应的成员栏添加默认界面
			 */
			function addClass(name) {
				//班级栏添加班级
				var a = document.createElement('a');
				a.innerText = name;
				if(classNameList[0] == name) {
					a.className = 'mui-control-item mui-active';
				} else {
					a.className = 'mui-control-item';
				}
				a.setAttribute('href', '#' + name);
				classlist.insertBefore(a, controladd);

				//成员栏添加默认元素
				var div = document.createElement('div');
				div.id = name;
				div.className = 'mui-slider-item mui-control-content';
				div.innerHTML = '<div class="mui-scroll-wrapper">\
								<div class="mui-scroll">\
									<ul class="mui-table-view">\
										<div class="mui-row" style="margin-top: 8px;">\
											<li id="addmember_' + name + '" class="mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3">\
												<div class="keep-box-shadow-border keep-member addmember" data-id="' + name + '">\
													<img src="../../image/cloud/record_add.png" style="height: 30px;width: 30px;margin-top: 18px;" />\
												</div>\
											</li>\
										</div>\
									</ul>\
								</div>\
							</div>';
				classmemberlist.appendChild(div);
				mui(".mui-slider").slider().refresh();
			}

			/**
			 * 添加成员
			 * @param {Object} classTable
			 * @param {Object} addTable
			 * @param {Object} value
			 */
			function addMember(classTable, addTable, value) {
				var li = document.createElement('li');
				li.className = 'mui-table-view-cell mui-media mui-col-xs-3 mui-col-sm-3';
				li.innerHTML = '<div class="keep-box-shadow-border keep-member">\
									<img src="../../image/quan/u108.jpg" />\
									<p class="mui-ellipsis">' + value + '</p>\
								</div>';
				classTable.insertBefore(li, addTable);
			}
		});
	</script>

</html>