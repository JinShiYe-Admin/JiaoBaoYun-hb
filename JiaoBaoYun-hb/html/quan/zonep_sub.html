<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>空间</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<link rel="stylesheet" type="text/css" href="../../css/icons-extra.css" />
		<link rel="stylesheet" href="../../css/iconfont/iconfont.css" />
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/quan/dynamiclistitem.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/utils/native.js"></script>
		<style>
			.mui-table-view-cell,
			.mui-table-view-cell:active {
				background-color: #FFFFFF;
			}
			
			.mui-table-view {
				background: transparent;
				/*背景色透明*/
			}
			
			.mui-table-view-cell {
				background: white;
				/*cell 背景设为白色*/
				padding: 0;
				/*内边距为0*/
				margin-bottom: 10px;
			}
			
			.mui-table-view:before,
			.mui-table-view:after,
			.mui-table-view-cell:after {
				height: 0px;
				/*去掉横线*/
			}
			
			.mui-row-padding-8px {
				padding: 8px;
				/*内边距为8px*/
				padding: 12px;
			}
			
			.dynamic-personal-image {
				/*个人头像圆形*/
				border-radius: 50%;
				width: 50px;
				height: 50px;
			}
			
			.dynamic-image-div {
				/*内容中图片之间的内边距*/
				padding: 1px;
			}
			
			.dynamic-image {
				/*内容的图片占全部空间*/
				width: 100%;
				height: 100%;
			}
			
			.dynamic-icon,
			.dynamic-icon-praise,
			.dynamic-icon-comment,
			.dynamic-icon-forward {
				/*点赞，评论，分享的图标*/
				height: 30px;
				width: 30px;
				margin-left: 25px;
			}
			
			.dynamic-icon-Level {
				/*等级图标*/
				height: 20px;
				margin-left: 10px;
			}
			
			.dynamic-icon-praise-small {
				/*点赞列表的小图标*/
				height: 15px;
				width: 15px;
				margin-right: 5px;
				margin-bottom: 0px;
			}
			
			.dynamic-margin-top-10px {
				margin-top: 10px;
			}
			
			.dynamic-padding-left-10px {
				padding-left: 10px;
			}
			
			.dynamic-line {
				/*点赞列表上面的横线*/
				height: 1px;
				width: 100%;
				background: #e4e4e4;
			}
			
			.dynamic-contenttext {
				/*动态内容*/
				font-family: '微软雅黑 Regular', '微软雅黑';
				/*字体样式*/
			}
			
			.dynamic-praise-name,
			.dynamic-comment-name {
				/*点赞者和评论者的名字*/
				color: #1277C7;
			}
			
			.replyComment {
				padding-top: 5px;
			}
			
			.dynamic-comment-btn {
				/*底部的评论按钮*/
				width: 100%;
				margin-top: 10px;
				border-width: 1px;
				border-color: #e4e4e4;
			}
			
			.dynamic-image-more {
				/*更多图片*/
				position: absolute;
				width: 99%;
				height: 99%;
				font-size: 40px;
				color: white;
				text-align: center;
				background-color: rgba(0, 0, 0, 0.3);
			}
			
			.mui-popover {
				position: fixed;
				height: 45px;
				width: 60px;
			}
			
			footer {
				height: 60px;
				width: 100%;
				z-index: 20;
				background-color: white;
				border-color: lightgray;
				border-width: 5px;
				position: fixed;
				bottom: 0;
				display: none;
			}
			
			.footer-center {
				display: inline-block;
				width: 75%;
				padding: 5px;
				height: 100%;
			}
			
			.footer-center .input-text {
				background: #fff;
				border: solid 1px #ddd;
				padding: 10px !important;
				font-size: 16px !important;
				line-height: 18px !important;
				font-family: verdana !important;
				overflow: hidden;
				height: 40px;
			}
			
			.btn-commit {
				position: absolute;
				top: 10px;
				right: 10px;
				display: inline-block;
				width: 20%;
			}
		</style>
	</head>

	<body>
		<footer id="footer" class="mui-bar mui-bar-tab" style="display: none;">
			<div class="footer-center">
				<textarea onblur="inputOnblur(this)" id='msg-content' type="text" class='input-text'></textarea>
			</div>
			<button id='btn-reply' class="mui-btn mui-btn-green btn-commit" style="background-color: #1db8F1;border-color:#1db8F1 ;">评论</button>
		</footer>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul class="mui-table-view">

				</ul>
			</div>

		</div>

		<!--<div id="comment-popover" class="mui-popover" style="width: 100%;top: 150px;height: 200px;">
			<ul class="mui-table-view">
				<img id="closepop" src="../../image/cloud/record_addclassclose.png" style="height: 30px;float: right;margin: 10px;" />
				<input onblur="inputOnblur(this)" id="inputComment" type="text" class="mui-input-clear" placeholder="请输入评论内容" style="width:80% ;margin-left: 10%;text-align: center;border-radius: 50px;">
				<button id="addComment" type="button" class="mui-btn mui-btn-blue mui-btn-block" style="border-radius: 50px;height: 40px;width: 80%;left: 10%;padding: 0;">评论</button>
		</div>-->

	</body>

	<script>
		var pageFlag = 0;
		var publisherId; //发布者id
		var tempIndex; //节点对象id
		var personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid; //用户id
		var personalunick = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).unick; //用户昵称
		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
				up: {
					contentrefresh: '正在加载...',
					callback: pullupRefresh
				}
			}
		});

		var tempPage = 1; //页码，请求第几页数据
		var totalCnt = 0; //当前留言的总条数
		var flag = 2; //判断是加载更多1，还是刷新2
		var zonepArray = []; //页码请求到要显示的数据，array[model_userNoteInfo]

		//请求数据
		function requestData(comData) {
			// 等待的对话框
			var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
			//28.（用户空间）获取用户针对某用户的空间列表
			postDataPro_getUserSpacesByUserForPublisher(comData, wd, function(data) {
				wd.close();
				console.log('获取个人空间列表_getUserSpacesByUserForPublisher:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
				if(data.RspCode == 0) {
					if(data.RspData.Data.length == 0) {
						mui.toast('暂无动态')
						return;
					}
					setUserSpaceReadByUser();
					totalCnt = data.RspData.TotalCnt;
					var tempRspData = data.RspData.Data;
					//获取当前回调留言的个人信息，主要是头像、昵称
					var tempArray = [];
					//先遍历回调数组，获取
					for(var item in tempRspData) {
						//当前循环的model
						var tempModel0 = tempRspData[item];
						//将当前model中id塞到数组
						tempArray.push(tempModel0.PublisherId);
						//合并数组,点赞的人
						tempArray = tempArray.concat(tempModel0.LikeUsers);
						tempModel0.LikeUsers = arrayDupRemoval(tempModel0.LikeUsers);
						//循环当前model中的回复数组
						for(var item1 in tempModel0.Comments) {
							//回复中的model
							var tempModel1 = tempModel0.Comments[item1];
							//将回复中的id塞到数组
							tempArray.push(tempModel1.UserId);
							tempArray.push(tempModel1.ReplyId);
							//
							for(var item2 in tempModel1.Replys) {
								//回复中的model
								var tempModel2 = tempModel1.Replys[item2];
								//将回复中的id塞到数组
								tempArray.push(tempModel2.UserId);
								tempArray.push(tempModel2.ReplyId);
							}
						}
					}
					//给数组去重
					tempArray = arrayDupRemoval(tempArray);
					//发送获取用户资料申请
					var tempData = {
						vvl: tempArray.join(), //用户id，查询的值,p传个人ID,g传ID串
						vtp: 'g' //查询类型,p(个人)g(id串)
					}

					//21.通过用户ID获取用户资料
					postDataPro_PostUinf(tempData, wd, function(data1) {
						wd.close();
						console.log('获取个人资料success:RspCode:' + data1.RspCode + ',RspData:' + JSON.stringify(data1.RspData) + ',RspTxt:' + data1.RspTxt);
						if(data1.RspCode == 0) {
							//循环当前的个人信息返回值数组
							for(var i in data1.RspData) {
								//当前model
								var tempModel = data1.RspData[i];
								//更新头像
								tempModel.uimg = updateHeadImg(tempModel.uimg, 2);
								//循环留言数组
								for(var item in tempRspData) {
									//当前循环的model
									var tempModel0 = tempRspData[item];
									//遍历点赞的人
									for(var item2 in tempModel0.LikeUsers) {
										//										console.log('item2;;;;;==' + tempModel.utid + ',' + tempModel0.LikeUsers[item2]);
										if(tempModel.utid == tempModel0.LikeUsers[item2]) {
											tempModel0.LikeUsers.splice(item2, 1, tempModel);
										}
									}
									//对比id是否一致
									if(tempModel0.PublisherId == tempModel.utid) {
										//合并
										tempModel0 = $.extend(tempModel0, tempModel);
									}
									//循环当前model中的回复数组
									for(var item1 in tempModel0.Comments) {
										//回复中的model
										var tempModel1 = tempModel0.Comments[item1];
										//对比id是否一致
										if(tempModel.utid == tempModel1.UserId) {
											//添加参数
											tempModel1.UserIdName = tempModel.unick;
										}
										if(tempModel.utid == tempModel1.ReplyId) {
											//添加参数
											tempModel1.ReplyIdName = tempModel.unick;
										}
										//
										for(var item2 in tempModel1.Replys) {
											//回复中的model
											var tempModel2 = tempModel1.Replys[item2];
											//对比id是否一致
											if(tempModel.utid == tempModel2.UserId) {
												//添加参数
												tempModel2.UserIdName = tempModel.unick;
											}
											if(tempModel.utid == tempModel2.ReplyId) {
												//添加参数
												tempModel2.ReplyIdName = tempModel.unick;
											}
										}
									}
								}
							}
						}
						console.log('循环遍历后的值：' + JSON.stringify(tempRspData));

						var table = document.body.querySelector('.mui-table-view');
						//判断是加载更多1，还是刷新2
						if(flag == 1) {
							var tempLength = zonepArray.length;
							//合并数组
							zonepArray = zonepArray.concat(tempRspData);
							mui('#pullrefresh').pullRefresh().endPullupToRefresh(); //参数为true代表没有更多数据了。
							for(var i = tempLength; i < zonepArray.length; i++) {
								id = i;
								var data = addData(i);
								dynamiclistitem.addItem(table, data, id);
							}
						} else {
							tempPage = 1;
							zonepArray = tempRspData;
							table.innerHTML = '';
							for(var i = 0; i < zonepArray.length; i++) {
								id = i;
								var data = addData(i);
								dynamiclistitem.addItem(table, data, id);
							}
						}
					});
				} else {
					mui.toast(data.RspTxt);
				}
			});
		}

		var id = 0; //cell的id
		mui.plusReady(function() {
			initNativeObjects();
			addReplyView();
			addReplyLisetner()
			publisherId = plus.webview.currentWebview().data.data; //发布者id

			tempPage = 1; //页码，请求第几页数据
			totalCnt = 0; //当前留言的总条数
			flag = 2; //判断是加载更多1，还是刷新2
			var comData = {
				userId: personalUTID, //用户ID
				publisherId: publisherId, //发布用户ID
				noteType: '2', //信息类型,1云笔记,2个人空间动态
				pageIndex: (tempPage).toString(), //当前页数
				pageSize: '10' //每页记录数
			};
			requestData(comData);
			window.addEventListener('refreshZonep', function(data) {
				requestData(comData)
			})

			var click = []; //记录被点击的li的id和被点击元素

			mui('.mui-table-view').on('tap', '.mui-table-view-cell', function() {
				var toast = '';
				mui.each(click, function(index, element) {
					toast = toast + element;
				});
				var id = this.getAttribute('id');

				click.push(id);
				//								mui.toast('li-id:' + click[click.length - 1] + '-' + toast);
				click = [];
			});

			mui('.mui-table-view').on('tap', '.dynamic-personal-image', function() {
				click.push('头像');
			});
			mui('.mui-table-view').on('tap', 'h4', function() {
				click.push('姓名');
			});
			//删除动态
			mui('.mui-table-view').on('tap', '.mui-icon-closeempty', function() {
				var btnArray = ['取消', '确定'];
				var closeId = this.id;
				mui.confirm('确定删除此条动态？', '提醒', btnArray, function(e) {
					if(e.index == 1) {
						var index = closeId.replace('delete', '');
						console.log(closeId);
						var comData = {
							userSpaceId: zonepArray[index].TabId, //用户空间ID
						};
						var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
						postDataPro_delUserSpaceById(comData, wd, function(data) {
							wd.close();
							if(data.RspCode == 0) {
								mui.toast('已删除');
								//						var wobj = plus.webview.currentWebview();
								//						wobj.reload(true);
								var deleteNode = document.getElementById(index);
								console.log(deleteNode.parentNode.innerHTML);
								deleteNode.parentNode.removeChild(deleteNode);
								console.log(deleteNode.parentNode);
								zonepArray.splice(index, 1)
							} else {
								mui.toast(data.RspTxt);
							}

						})
					} else {

					}
				})

				click.push('向下按钮');
			});
			mui('.mui-table-view').on('tap', '.dynamic-contenttext', function() {
				click.push('动态文字');
			});
			mui('.mui-table-view').on('tap', '.dynamic-image', function() {
				click.push('图片' + this.getAttribute('src'));
			});
			mui('.mui-table-view').on('tap', '.dynamic-image-more', function() {
				click.push('更多图片');
			});
			//点赞和取消点赞
			mui('.mui-table-view').on('tap', '.dynamic-icon-praise', function() {
				click.push('点赞');
				personalUTID = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).utid; //用户id
				var index = this.id.replace('praise', '');
				var color = this.style.color;
				if(color == 'rgb(143, 143, 148)') {
					var comData = {
						userId: personalUTID, //用户ID
						userSpaceId: zonepArray[index].TabId, //用户空间ID
					};
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_setUserSpaceLikeByUser(comData, wd, function(data) {
						wd.close();
						if(data.RspCode == 0) {
							console.log('index=' + index)
							var a = document.getElementById("praise" + index);
							a.style.color = 'rgb(0, 165, 224)'
							//							mui.toast('点赞成功');
							var PraiseList = document.getElementById("PraiseList" + index);
							console.log(PraiseList.innerHTML);
							var praiseNameList = PraiseList.getElementsByTagName("font");
							console.log(praiseNameList.length)
							if(praiseNameList.length > 0) {
								var praiseName = praiseNameList[0];
								praiseName.innerHTML = praiseName.innerHTML + '、' + personalunick;
								console.log(praiseName.innerHTML);
							} else {

								PraiseList.innerHTML = '<img id= "praiseImg" src="../../image/dynamic/icon_praise_small.png" class="dynamic-icon-praise-small mui-pull-left" />' +
									'<font class="common-font-family-Regular dynamic-praise-name">' + personalunick + '</font>';
							}
						} else {
							mui.toast(data.RspTxt);
						}

					})

				} else {

					var comData = {
						userId: personalUTID, //用户ID
						userSpaceId: zonepArray[index].TabId, //用户空间ID
					};
					var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
					postDataPro_delUserSpaceLikeByUser(comData, wd, function(data) {
						wd.close();
						if(data.RspCode == 0) {
							var a = document.getElementById("praise" + index);
							a.style.color = 'rgb(143, 143, 148)'
							//							mui.toast('取消点赞成功');
							var PraiseList = document.getElementById("PraiseList" + index);
							var praiseName = PraiseList.getElementsByTagName("font")[0];
							if(praiseName.innerHTML.indexOf('、') > -1) {
								console.log('多个人点赞')
								praiseName.innerHTML = praiseName.innerHTML.replace('、' + personalunick, '');
								praiseName.innerHTML = praiseName.innerHTML.replace(personalunick, '');
							} else {
								console.log('一个人点赞')

								console.log(PraiseList.outerHTML);
								PraiseList.removeChild(praiseName);
								var praiseImg = document.getElementById("praiseImg");
								PraiseList.removeChild(praiseImg);

							}
						} else {
							mui.toast(data.RspTxt);
						}

					})

				}

			});

			mui('.mui-table-view').on('tap', '.dynamic-icon-forward', function() {
				click.push('分享');
			});
			mui('.mui-table-view').on('tap', '.dynamic-praise-name', function() {
				click.push('点赞者：' + this.innerText);
			});
			mui('.mui-table-view').on('tap', '.dynamic-comment-name', function() {
				click.push('评论者：' + this.innerText);
			});

		});
		var addReplyView = function() {
			//			评论
			mui('.mui-table-view').on('tap', '.dynamic-icon-comment', function() {
				//				click.push('评论');
				tempIndex = this.id.replace('comment', '');
				console.log('tempIndex====' + tempIndex)
				var replyContainer = document.getElementById('footer');
				document.getElementById('footer').className = 'mui-bar-tab';
				replyContainer.style.display = 'block';
				showSoftInput('#msg-content');
				window.event.stopPropagation()

			});
			//底部评论按钮
			mui('.mui-table-view').on('tap', '.dynamic-comment-btn', function() {
				tempIndex = this.id.replace('bottomComment', '');
				console.log('tap====' + tempIndex)
				var replyContainer = document.getElementById('footer');
				document.getElementById('footer').className = 'mui-bar-tab';
				replyContainer.style.display = 'block';
				showSoftInput('#msg-content');
				window.event.stopPropagation()
			});

			//			回复评论
			mui('.mui-table-view').on('tap', '.replyComment', function() {

				tempIndex = this.id.replace('replyComment', '');
				console.log('tempIndex====' + tempIndex)
				var replyContainer = document.getElementById('footer');
				document.getElementById('footer').className = 'mui-bar-tab';
				replyContainer.style.display = 'block';
				showSoftInput('#msg-content');
				window.event.stopPropagation()

			});

		}

		//加载数据
		function addData(index) {
			//[[InfoList],[ImageList],[InteractionList]]动态的信息
			var Data = [];
			var InfoList = []; //头部和内容
			var ImageList = []; //内容的图片
			var InteractionList = []; //底部内容

			//个人信息和内容
			//[personalImage,personalName,time,contentText]个人头像，姓名，发布时间，动态内容的文字
			//判断img是否为null，或者空
			var tempModel = zonepArray[index];
			tempModel.uimg = updateHeadImg(tempModel.uimg)

			var personalImage = tempModel.uimg;
			var personalName = tempModel.unick;
			var time = tempModel.PublishDate;
			var contentText = tempModel.MsgContent;
			InfoList.push(personalImage);
			InfoList.push(personalName);
			InfoList.push(time);
			InfoList.push(contentText);
			if(tempModel.EncImgAddr != '') {
					var EncImgAddrs = tempModel.EncImgAddr.split('|');
					//内容的图片
					for(var i = 0; i < EncImgAddrs.length; i++) {
						ImageList.push(EncImgAddrs[i])
					}
				}

				//底部
				//[introduce，viewCount，[praiseList],[commentList]]信息说明，浏览次数，点赞列表数组，评论列表数组
				var introduce = '上传了' + ImageList.length + '张图片到相册《手机相册》';
			var viewCount = tempModel.ReadCnt;
			var praiseList = [];
			if(tempModel.LikeUsers.length != 0) {
				for(var i = 0; i < tempModel.LikeUsers.length; i++)
					praiseList.push(tempModel.LikeUsers[i].unick);
			}

			//[commentList]:评论列表
			//1.评论[commenter,content]，评论者，评论内容
			//2.回复[replyer，commenter，replyContent]回复者，评论者，回复的内容
			var commentList = [];

			for(var i = 0; i < tempModel.Comments.length; i++) {

				var tempComment = tempModel.Comments[i];
				commentList.push(tempComment);
				//				if(tempComment.Replys.length != 0) {
				//					var replys = tempComment.Replys
				//					for(var j = 0; j < replys.length; j++) {
				//						var replyModel = replys[j];
				//						commentList.push(replyModel);
				//					}
				//
				//				}

			}

			InteractionList.push(introduce);
			InteractionList.push(viewCount);
			InteractionList.push(praiseList);
			InteractionList.push(commentList);

			Data = [InfoList, ImageList, InteractionList]
			return Data;
		}

		function addReplyLisetner() {
			events.addTap('btn-reply', function() {

				var replyName = window.myStorage.getItem(window.storageKeyName.PERSONALINFO).unick
				var inputComment = document.getElementById("msg-content");
				var name = inputComment.value; //评论内容
				if(name == '') {
					mui.toast('不允许为空');
				} else {
					if(tempIndex.indexOf('-') >= 0) {
						var indexArr = tempIndex.split('-');
						var id = indexArr[0];
						var commentId = indexArr[1];
						var replyId = indexArr[2];

						var tempModel = zonepArray[id].Comments[commentId];
						var upperId = tempModel.TabId;
						var replyUserId;
						var ReplyIdName;
						if(replyId == '评论') {
							replyUserId = tempModel.UserId
							ReplyIdName = tempModel.UserIdName
						} else {
							replyUserId = tempModel.Replys[replyId].UserId;
							ReplyIdName = tempModel.Replys[replyId].UserIdName;
						}

						var comData = {
							userId: personalUTID, //用户ID
							upperId: upperId, //上级评论ID
							replyUserId: replyUserId, //回复ID
							userSpaceId: zonepArray[id].TabId, //用户空间ID
							commentContent: inputComment.value //回复内容
						};
						console.log('comData=====' + JSON.stringify(comData))
						var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
						postDataPro_addUserSpaceCommentReply(comData, wd, function(data) {
							wd.close();

							console.log('添加空间评论回复_addUserSpaceCommentReply' + JSON.stringify(data));

							var replyComment = document.getElementById('replyComment' + id + '-' + commentId + '-' + '评论');
							var nextReplyComment = document.createElement('div');
							var html2 = '<font class="common-font-family-Regular dynamic-comment-name">' + personalunick + '</font>';
							var html3 = '<font class="common-font-family-Regular">回复</font>';
							var html4 = '<font class="common-font-family-Regular dynamic-comment-name">' + ReplyIdName + '</font>';
							var html5 = '<font class="common-font-family-Regular">:' + inputComment.value + '</font>'
							nextReplyComment.innerHTML = html2 + html3 + html4 + html5;
							replyComment.appendChild(nextReplyComment);
							document.getElementById('footer').className = '';
							document.getElementById('footer').style.display = 'none';
							jQuery('#msg-content').blur();
							inputComment.value = '';

						})
					} else {
						var comData = {
							userId: personalUTID, //用户ID
							userSpaceId: zonepArray[tempIndex].TabId, //用户空间ID
							commentContent: inputComment.value //回复内容
						};
						var tempValue = inputComment.value;
						var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
						postDataPro_addUserSpaceComment(comData, wd, function(data) {
							wd.close();
							console.log('添加空间评论_addUserSpaceComment' + JSON.stringify(data));
							var commentArr = zonepArray[tempIndex].Comments;
							console.log("commentList" + tempIndex);
							var commentList = document.getElementById("commentList" + tempIndex);
							var html1 = '<div id="replyComment' + tempIndex + '-' + commentArr.length + '-' + '评论' + '" class="mui-media-body replyComment">';
							var html2 = '<font class="common-font-family-Regular dynamic-comment-name ">' + personalunick + '</font>';
							var html3 = '<font class="common-font-family-Regular">：' + tempValue + '</font></div>';
							var htmlComment = html1 + html2 + html3;
							commentList.innerHTML = commentList.innerHTML + htmlComment
							document.getElementById('footer').className = '';
							document.getElementById('footer').style.display = 'none';
							jQuery('#msg-content').blur();
							inputComment.value = '';

						})
					}

				}

			})
		}

		//设置个人空间动态为已读
		function setUserSpaceReadByUser() {
			if(personalUTID == publisherId) {
				var comData = {
					userId: personalUTID, //用户ID
					spaceTypes: '[4,5,6]'
				}
				var wd;
				postDataPro_setCommentMsgReadByUser(comData, wd, function(data) {
					console.log('与我相关设置成已读success:RspCode:' + JSON.stringify(data));
				})
			}

			var NoReadCnt = plus.webview.currentWebview().data.NoReadCnt //未读条数
			//			if(NoReadCnt != 0) { //如果未读条数不为0，则设置空间状态为已读
			var comData = {
				userId: personalUTID, //用户ID
				publisherId: publisherId
			};

			var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
			postDataPro_setUserSpaceReadByUser(comData, wd, function(data) {
				wd.close();
				console.log('设置空间状态为已读_setUserSpaceReadByUser' + JSON.stringify(data));
				if(data.RspCode == 0) {
					//获得主页面的webview
					var main = plus.webview.getWebviewById('../quan/tab-zone.html');
					//触发tab-zone页面的setRead事件
					mui.fire(main, 'setRead', {
						flag: 3
					});

				}

			})
			//			}
		}
		/**
		 * 下拉刷新具体业务实现
		 */
		function pulldownRefresh() {
			setTimeout(function() {
				flag = 2; //下拉刷新
				totalCnt = 0; //总页数
				tempPage = 1; //刷新时将页码归1
				var comData = {
					userId: personalUTID, //用户ID
					publisherId: publisherId, //发布用户ID
					noteType: '2', //信息类型,1云笔记,2个人空间动态
					pageIndex: (tempPage).toString(), //当前页数
					pageSize: '10' //每页记录数
				};
				//请求数据
				requestData(comData);
				mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
			}, 1500);
		}

		/**
		 * 上拉加载具体业务实现
		 */
		function pullupRefresh() {
			//			setTimeout(function() {
			flag = 1; //上拉加载更多
			if(tempPage * 10 > totalCnt || tempPage * 10 == totalCnt) {
				mui.toast('没有更多了...');
				mui('#pullrefresh').pullRefresh().endPullupToRefresh();
			} else {
				tempPage++;
				var comData = {
					userId: personalUTID, //用户ID
					publisherId: publisherId, //发布用户ID
					noteType: '2', //信息类型,1云笔记,2个人空间动态
					pageIndex: (tempPage).toString(), //当前页数
					pageSize: '10' //每页记录数
				};
				//请求数据
				requestData(comData);

			}

		}

		//失去焦点事件
		function inputOnblur(input) {
			var inputComment = document.getElementById("msg-content");
			inputComment.value = '';
			document.getElementById('footer').className = '';
			document.getElementById('footer').style.display = 'none';
		}
	</script>

</html>