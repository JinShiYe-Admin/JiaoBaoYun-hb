<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<h1 id="title" class="mui-title"></h1>
		</header>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/utils/events.js"></script>
		<script src="../../js/publicProtocol.js"></script>
		<script type="text/javascript">
			var cities;
			mui.init();
			mui.plusReady(function() {
				events.preload("sciedu_show_main.html", 500);
				requireFocusCities();
			});
			//获取定制的城市
			function requireFocusCities() {
				if(!events.getUtid()) {
					cities = myStorage.getItem(storageKeyName.SECITY) || [];
					addAll(cities);
					return;
				}
				postDataPro_PostUTcity({
					vvl: 0
				}, null, function(data) {
					console.log("sciedu-home.html获取的订制的城市:", data);
					if(data.RspCode == 0) {
						if(data.RspData[0]) {
							rechargeCities(data.RspData[0].citys);
						} else {
							addAll(cities);
						}
					} else if(data.RspCode == 9) {
						var cityInfo = myStorage.getItem(storageKeyName.PERSONALINFO).uarea;
						console.log("sciedu-home.html获取的城市信息：", cityInfo);
					}
				})
			}
			/**
			 * 重组城市信息
			 * @param {Object} citiesStr
			 */
			function rechargeCities(citiesStr) {
				var citiesCNA = citiesStr.split('|');
				cities = citiesCNA.map(function(cityCN, index, array) {
					var cityInfo = cityCN.split('_');
					return {
						cityCode: cityInfo[0],
						cityName: cityInfo[1]
					}
				})
				addAll(cities);
			}
			/**
			 * 加载全部
			 * @param {Object} cities
			 */
			function addAll(cities) {
				cities.push({
					cityCode: '000000',
					cityName: '全部'
				})
				setTitle();
			}
			/**
			 * 设置标题
			 */
			function setTitle() {
				document.getElementById("title").innerText = cities[0].cityName;
				for(var i = 0; i < cities.length; i++) {

				}
				events.fireToPageNone("sciedu-list.html", "seCities", cities);
			}
		</script>
	</body>

</html>