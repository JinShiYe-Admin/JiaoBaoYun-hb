<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />

	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">设置</h1>
		</header>
		<div class="mui-content">
			<ul class="mui-table-view">
				<!--<li class="mui-table-view-cell">
					<a class="mui-navigate-right" id="yinsi"  style="font-size: 15px;">
						隐私
					</a>
				</li>-->
				<li class="mui-table-view-cell">
					<a id="change-passwords" class="mui-navigate-right" style="font-size: 15px;">
						修改密码
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right" id="quit" style="font-size: 15px;">
						退出登录
					</a>
				</li>
			</ul>
		</div>
		<script src="../../js/mui.min.js"></script>
		<!--共用事件-->
		<script src="../../js/utils/events.js" type="text/javascript" charset="utf-8"></script>
		<!--本地存储-->
		<script src="../../js/libs/myStorage/myStorage.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/storageKeyName.js" type="text/javascript" charset="utf-8"></script>
		<!--共用协议-->
		<script src="../../js/publicProtocol.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				//隐私
//				events.addTap('yinsi', function() {
//					mui.toast('此功能暂未开放');
//				});
				//修改密码
				events.preload('../register/modify_password.html');
				events.addTap('change-passwords', function() {
						events.fireToPageNone('../register/modify_password.html', 'changePasswords');
						plus.webview.getWebviewById('modify_password.html').show()
//						events.openNewWindowWithData('QRCode.html');
//						events.openNewWindowWithData('ReadQRCode.html');
					})
					//退出
				events.addTap('quit', function() {
					console.log('2222');
					var btnArray = [{
						title: "确定"
					}];
					plus.nativeUI.actionSheet({
						title: "确定退出？",
						cancel: "取消",
						buttons: btnArray
					}, function(e) {
						var index = e.index;
						switch(index) {
							case 0: //取消
								break;
							case 1: //退出登录
								//判断是否设置了密码
								//存储个人信息
								var tempInfo = window.myStorage.getItem(window.storageKeyName.PERSONALINFO);
								console.log('tempinfo:' + JSON.toString(tempInfo));
								if(Number(tempInfo.ispw) == 1) { //有密码
									//发送注销协议
									//25.用户注销
									//需要参数
									var comData = {

									};
									// 等待的对话框
									var wd = events.showWaiting();
									postDataPro_PostLoginOut(comData, wd, function(data) {
										wd.close();
										console.log('注销success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
										if(data.RspCode == 0) {
											tempInfo.isLogin = 1;
											//修改自动登录值
											window.myStorage.setItem(window.storageKeyName.PERSONALINFO, null);
											//退出登录
											events.logOff();
//											plus.runtime.quit();
											//跳转到登录界面
											events.openNewWindowWithData('../../html/register/login.html', '');
										} else {
											mui.toast(data.RspTxt);
										}
									});

								} else { //无密码
									events.fireToPageNone('../register/modify_password.html', 'settingPW');
									events.openNewWindowWithData('modify_password.html', '');
								}

								break;
						}
					});
				});
			});
		</script>
	</body>

</html>