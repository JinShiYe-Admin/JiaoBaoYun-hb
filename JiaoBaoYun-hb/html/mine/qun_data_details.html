<!--
	作者：444811716@qq.com
	时间：2016-11-24
	描述：资料详情
-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>资料详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/utils/common.css" />
		<!--<link rel="stylesheet" href="../../css/mui.picker.min.css" />-->
		<!--<link rel="stylesheet" href="../../css/mui.poppicker.css" />-->
		<script src="../../js/mui.min.js"></script>
		<!--<script type="text/javascript" src="../../js/mui.picker.min.js"></script>-->
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>

		<style>
			body,
			.mui-content {
				background: white;
			}

			.mui-content>.mui-table-view:first-child {
				margin-top: 0px
			}

			.mui-table-view:before,
			.mui-table-view:after {
				height: 0px;
			}

			.mui-table-view-cell {
				padding: 5px 15px;
			}

			.mui-table-view-cell:after {
				left: 0px;
			}

			.mui-input-row label {
				width: 20%;
				padding: 11px 0px
			}

			.mui-input-row label~input {
				width: 80%;
			}

			.gender {
				/*性别选择*/
				float: right;
				width: 80%;
				height: 40px;
				padding: 10px 15px;
				padding-left: 0px;
				line-height: 21px;
				-webkit-user-select: text;
				border-radius: 3px;
				outline: 0;
				-webkit-appearance: none;
				font-size: 17px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="color: white;">资料详情</h1>
			<h1 id="finish" class="mui-title" style="text-align: right;right: 10px;display: none;color: gray;">保存</h1>
		</header>

		<div class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<ul class="mui-table-view">
					<div id="stu_show" style="display:none;">
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>学生姓名:</label>
								<input id="stu_name" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
								<div style="position: absolute;right: 0px;top: 13px;color: red;font-size: 24px;">*</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>学生账号:</label>
								<input id="stu_utid" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>学生电话:</label>
								<input id="stu_phone" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row ">
								<label>性别:</label>
								<div id="stu_gender" class="gender"></div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input id="stu_ugname" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>所属群:</label>
								<input id="stu_gname" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>简介:</label>
								<!--<input id="stu_introduction" type="text" class="mui-input-clear" disabled>-->
							</div>
							<p id="stu_introduction" style="font-size: 17px;word-break:break-all;"></p>
						</li>
					</div>
					<div id="tea_show" style="display:none;">
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>姓名:</label>
								<input id="tea_name" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
								<div style="position: absolute;right: 0px;top: 13px;color: red;font-size: 24px;">*</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>账号:</label>
								<input id="tea_utid" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>手机号:</label>
								<input id="tea_uid" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input id="tea_ugname" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>性别:</label>
								<div id="tea_gender" class="gender"></div>
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>所属群:</label>
								<input id="tea_gname" type="text" class="mui-input-clear" disabled>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职位:</label>
								<input id="tea_job" type="text" class="mui-input-clear" value="" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>科目:</label>
								<input id="tea_sub" type="text" class="mui-input-clear" value="" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职称:</label>
								<input id="tea_title" type="text" class="mui-input-clear" value="" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>教龄:</label>
								<input id="tea_expsch" type="number" oninput="if(value.length>10)value=value.slice(0,10)" class="mui-input-clear" value="">
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>简介:</label>
								<!--<input id="tea_introduction" type="text" class="mui-input-clear" disabled>-->
							</div>
							<p id="tea_introduction" style="font-size: 17px;word-break:break-all;"></p>
						</li>
					</div>
				</ul>
			</div>
		</div>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				var mstype = ''; //查询的资料类型0家长,2老师,3学生
				var role = ''; //用户管理角色0家长,1管理员,2老师,3学生
				var teaData = null; //记录获取的老师的资料
				var stuData = []; //记录获取的学生资料
				var parData = []; //记录获取的学生资料的家长信息
				var postNum = 0; //记录发送修改协议的次数
				var change = false; //判断是否允许保存

				//---学生界面中相关的元素---start---
				var stu_name = document.getElementById("stu_name"); //学生姓名
				var stu_utid = document.getElementById("stu_utid"); //学生账号
				var stu_phone = document.getElementById("stu_phone"); //学生电话
				var stu_gender = document.getElementById("stu_gender"); //学生性别
				var stu_ugname = document.getElementById("stu_ugname"); //学生群昵称
				var stu_gname = document.getElementById("stu_gname"); //学生所属群
				var stu_introduction = document.getElementById("stu_introduction"); //学生简介
				//---学生界面中相关的元素---end---

				//---老师界面中相关的元素---start---
				var tea_name = document.getElementById("tea_name"); //老师姓名
				var tea_utid = document.getElementById("tea_utid"); //老师账号
				var tea_uid = document.getElementById("tea_uid"); //老师手机号
				var tea_ugname = document.getElementById("tea_ugname"); //老师群昵称
				var tea_gender = document.getElementById("tea_gender"); //老师性别
				var tea_gname = document.getElementById("tea_gname"); //老师所属群
				var tea_job = document.getElementById("tea_job"); //老师职位
				var tea_sub = document.getElementById("tea_sub"); //老师科目
				var tea_title = document.getElementById("tea_title"); //老师职称
				var tea_expsch = document.getElementById("tea_expsch"); //老师教龄
				var tea_introduction = document.getElementById("tea_introduction"); //老师简介
				//---老师界面中相关的元素---end---

				//---从父页面获取数据---start---
				var main = plus.webview.currentWebview(); //获取当前窗体对象
				var data = main.data; //接收页面传入的参数值
				//var data = {
				//	gid: gid, //群id
				//	gname: gname, //群名称
				//	mstype: mstype, //用户管理角色,0家长,1管理员,2老师,3学生
				//	stuid: stuid, //资料id
				//	stuname: stuname, //资料名称
				//	stuimg: stuimg, //资料头像
				//	type: type, //资料类型
				//}
				console.log('从群资料页面获取的数据:' + JSON.stringify(data));
				role = data.mstype;
				if(role == 1) { //管理员才显示保存按钮
					document.getElementById("finish").style.display = 'inline';
				}
				switch(data.type) {
					case 'student': //学生
						mstype = 3;
						showStu();
						break;
					case 'teacher': //老师
						mstype = 2;
						showTea();
						break;
					case 'parents': //家长
						mstype = 3;
						showStu();
						break;
					default:
						switch(data.stumstype) {
							case 3: //学生
								mstype = 3;
								showStu();
								break;
							case 2: //老师
								mstype = 2;
								showTea();
								break;
							case 0: //家长
								//mstype = 0;
								//createPar();
								mstype = 3;
								showStu();
								break;
							default:
								switch(data.mstype) {
									case 1: //老师
										mstype = 2;
										showTea();
										break;
									case 3: //学生
										mstype = 3;
										showStu();
										break;
									case 2: //老师
										mstype = 2;
										showTea();
										break;
									case 0: //家长
										//mstype = 0;
										//createPar();
										mstype = 3;
										showStu();
										break;
									default:
										console.log('资料类型选择出错3');
										break;
								}
								console.log('资料类型选择出错2');
								break;
						}
						console.log('资料类型选择出错');
						break;
				}
				//---从父页面获取数据---end---

				mui('.mui-scroll-wrapper').scroll({
					scrollY: true, //是否竖向滚动
					bounce: true, //是否启用回弹
				});

				//保存按钮
				document.getElementById('finish').addEventListener('tap', function() {
					//console.log('保存：' + mstype + '|change:' + change);
					if(change) {
						document.getElementById("finish").style.color = 'gray';
						change = false;

						if(mstype == 2) {
							//老师
							changeTea(); //修改老师资料
						} else if(mstype == 3) {
							//学生
							var stuName = stu_name.value;
							if(stuName != data.stuname) { //判断是否修改了学生姓名
								console.log('更改学生姓名:' + stuName);
								postNum++;
								changeStuName(stuName); //更改学生姓名
							}

							mui.each(parData, function(index, item) {
								//console.log('家长信息:' + JSON.stringify(item));
								var urel = document.getElementById("par_urel_" + item.utid).value;
								if(urel != item.urel) { //判断是否修改了家长关系
									console.log('更改家长关系:' + item.utid + '|' + urel);
									postNum++;
									changeParUrel(item.ustuid, urel); //更新与家长关系
								}
							});
						}
					}
				});

				//输入判断，如果未改变不允许保存
				mui('.mui-content').on('input', 'input', function() {
					if(mstype == 2) { //老师
						if(tea_name.value == teaData.stuname && tea_job.value == teaData.job && tea_title.value == teaData.title && tea_sub.value == teaData.sub && (tea_expsch.value == teaData.expsch || (tea_expsch.value == '' && teaData.expsch == null))) {
							document.getElementById("finish").style.color = 'gray';
							change = false;
						} else {
							document.getElementById("finish").style.color = 'white';
							change = true;
						}
					} else if(mstype == 3) { //学生
						var parChange = false; //家长关系是否改变
						mui.each(parData, function(index, element) {
							var urel = document.getElementById("par_urel_" + element.utid).value;
							if(urel != element.urel) {
								parChange = true;
							}
						});
						console.log('parChange ' + parChange);
						if(stu_name.value == data.stuname && !parChange) {
							document.getElementById("finish").style.color = 'gray';
							change = false;
						} else {
							document.getElementById("finish").style.color = 'white';
							change = true;
						}
					}
				});

				//展示老师资料
				function showTea() {
					tea_name.value = data.stuname; //姓名
					tea_gname.value = data.gname; //所属群名称
					document.getElementById("tea_show").style.display = 'inline';
					if(role != 1) {
						tea_name.setAttribute('disabled', 'disabled'); //老师姓名
						tea_utid.setAttribute('disabled', 'disabled'); //老师账号
						tea_uid.setAttribute('disabled', 'disabled'); //老师手机号
						tea_ugname.setAttribute('disabled', 'disabled'); //老师群昵称
						tea_gender.setAttribute('disabled', 'disabled'); //老师性别
						//tea_gname.setAttribute('disabled', 'disabled');//老师所属群
						tea_job.setAttribute('disabled', 'disabled'); //老师职位
						tea_sub.setAttribute('disabled', 'disabled'); //老师科目
						tea_title.setAttribute('disabled', 'disabled'); //老师职称
						tea_expsch.setAttribute('disabled', 'disabled'); //老师教龄
						//tea_introduction.setAttribute('disabled', 'disabled'); //老师简介
					}
					getData(2);
				}

				//展示学生资料
				function showStu() {
					stu_name.value = data.stuname; //姓名
					stu_gname.value = data.gname; //所属群名称
					document.getElementById("stu_show").style.display = 'inline';
					if(role != 1) {
						stu_name.setAttribute('disabled', 'disabled'); //学生姓名
						//stu_utid.setAttribute('disabled', 'disabled'); //学生账号
						stu_phone.setAttribute('disabled', 'disabled'); //学生电话
						stu_gender.setAttribute('disabled', 'disabled'); //学生性别
						stu_ugname.setAttribute('disabled', 'disabled'); //学生群昵称
						//stu_gname.setAttribute('disabled', 'disabled'); //学生所属群
						//stu_introduction.setAttribute('disabled', 'disabled'); //学生简介
					}
					getData(3);
				}

				/**
				 * 通过用户资料ID获取用户各项资料
				 * @param {Object} type 资料类型2老师,3学生
				 */
				function getData(type) {
					var wd = events.showWaiting();
					console.log('type:' + type + '|stuid:' + data.stuid);
					//22.通过用户资料ID获取用户各项资料
					//所需参数
					var comData = {
						vvl: data.stuid //查询的用户资料ID
					};
					postDataPro_PostUuinf(comData, wd, function(data) {
						console.log('22通过用户资料ID获取用户各项资料postDataPro_PostUuinf:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							if(type == 2) { //老师
								teaData = data.RspData[0];
								//console.log('teaData:' + JSON.stringify(teaData));
								//								if(teaData.utid != null) { //账号
								//									tea_utid.value = teaData.utid;
								//								}
								if(teaData.ugname != null) { //昵称
									tea_ugname.value = teaData.ugname;
								}
								if(teaData.job != null) { //职位
									tea_job.value = teaData.job;
								}
								if(teaData.sub != null) { //科目
									tea_sub.value = teaData.sub;
								}
								if(teaData.title != null) { //职称
									tea_title.value = teaData.title;
								}
								if(teaData.expsch != null) { //教龄
									tea_expsch.value = teaData.expsch;
								}
								if(teaData.utid != null && teaData.utid != '') {
									getUserData([{
										utid: teaData.utid,
										dataType: '2'
									}]); //查找关联的老师账号信息
								}
							} else if(type == 3) { //学生
								var utidArray = [];
								mui.each(data.RspData, function(index, item) {
									if(item.utid != null && item.utid != '') {
										//console.log('获取学生详细信息:' + JSON.stringify(item));
										stuData.push(item); //记录获取的学生资料
										if(item.umstype == 3) {
											//关联的学生账号
											//stu_utid.value = item.utid;
											stu_ugname.value = item.ugname;
											utidArray.push({
												utid: item.utid,
												dataType: '3'
											});
										} else {
											parData.push(item);
											addParents(item);
											utidArray.push({
												utid: item.utid,
												dataType: '0'
											});
										}
									}
								});
								if(utidArray.length != 0) {
									getUserData(utidArray);
								}
							}
						} else {
							if(data.RspCode != 9) {
								mui.toast(data.RspTxt);
							}
						}
						wd.close();
					});
				}

				/**
				 * 添加家长信息
				 * @param {Object} data
				 */
				function addParents(data) {
					var div = document.createElement('div');
					div.id = 'par_' + data.utid;
					var html1 = '<li class="mui-table-view-cell">\
									<div class="mui-input-row">\
										<label>家长姓名:</label>\
										<input id="par_ugname_' + data.utid + '" type="text" class="mui-input-clear" value="' + data.ugname + '" disabled="disabled">\
									</div>\
								</li>\
								<li class="mui-table-view-cell">\
									<div class="mui-input-row">\
										<label>家长账号:</label>\
										<input id="par_uname_' + data.utid + '" type="text" class="mui-input-clear" disabled="disabled">\
									</div>\
								</li>';
					var html2 = '';
					if(role == 1) { //管理员
						html2 = '<li class="mui-table-view-cell">\
									<div class="mui-input-row">\
										<label>关系:</label>\
										<input id="par_urel_' + data.utid + '" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)" value="' + data.urel + '">\
									</div>\
								</li>';
					} else {
						html2 = '<li class="mui-table-view-cell">\
									<div class="mui-input-row">\
										<label>关系:</label>\
										<input type="text" class="mui-input-clear" value="' + data.urel + '" disabled="disabled">\
									</div>\
								</li>';
					}
					var html3 = '<li class="mui-table-view-cell">\
									<div class="mui-input-row">\
										<label>电话:</label>\
										<input id="par_phone_' + data.utid + '" type="text" class="mui-input-clear" disabled="disabled">\
									</div>\
								</li >\
								<div style="height:1px;width:100%;"></div>';
					div.innerHTML = html1 + html2 + html3;
					document.getElementById("stu_show").appendChild(div);
				}

				/**
				 * 获取账号的信息
				 * @param {Object} utidArray
				 * utidArray[i]={
				 * 	utid:'',//用户id
				 *  dataType:'' //0家长,2老师,3学生
				 * }
				 */
				function getUserData(utidArray) {
					var wd = events.showWaiting();
					var comData = null;
					//					var comData = {
					//						vvl: utid, //用户id，查询的值,p传个人ID,g传ID串
					//						vtp: 'p' //查询类型,p(个人)g(id串)
					//					};
					if(utidArray.length == 1) {
						//21.通过用户ID获取用户资料
						//所需参数
						comData = {
							vvl: utidArray[0].utid, //用户id，查询的值,p传个人ID,g传ID串
							vtp: 'p' //查询类型,p(个人)g(id串)
						};
					} else {
						var tempUtidArray = [];
						mui.each(utidArray, function(index, element) {
							tempUtidArray.push(element.utid);
						});
						var utidStr = tempUtidArray.join(',');
						comData = {
							vvl: utidStr, //用户id，查询的值,p传个人ID,g传ID串
							vtp: 'g' //查询类型,p(个人)g(id串)
						};
					}
					postDataPro_PostUinf(comData, wd, function(data) {
						console.log('21.通过用户ID获取用户资料postDataPro_PostUinf:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							var tempData = utidArray;
							var tempArry = [];
							mui.each(data.RspData, function(index, element) {
								mui.each(tempData, function(index2, element2) {
									if(element.utid == element2.utid) {
										var uData = element;
										if(element2.dataType == '3') { //学生
											if(uData.usex == 1) {
												stu_gender.innerText = '男';
											} else if(uData.usex == 2) {
												stu_gender.innerText = '女';
											} else {
												stu_gender.innerText = '';
											}
											stu_utid.value = uData.uname;
											stu_phone.value = uData.uid;
											stu_introduction.innerText = uData.utxt;
										} else if(element2.dataType == '0') { //家长
											document.getElementById("par_uname_" + uData.utid).value = uData.uname;
											document.getElementById("par_phone_" + uData.utid).value = uData.uid;
										} else if(element2.dataType == '2') { //教师
											if(uData.usex == 1) {
												tea_gender.innerText = '男';
											} else if(uData.usex == 2) {
												tea_gender.innerText = '女';
											} else {
												tea_gender.innerText = '';
											}
											tea_uid.value = uData.uid;
											tea_utid.value = uData.uname;
											tea_introduction.innerText = uData.utxt;
										} else {
											console.log('账号:设置类型出错');
										}
										tempArry.push(element2);
										tempData.splice(index2, 1);
									}
								});
							});
							getBeiZhu(tempArry);
						} else {
							mui.toast(data.RspTxt);
						}
						wd.close();
					});
				}

				/**
				 * 获取备注
				 * @param {Object} utidArray
				 */
				function getBeiZhu(utidArray) {
					var wd = events.showWaiting();
					var strUtid = '';
					if(utidArray.length == 1) {
						strUtid = utidArray[0].utid
					} else {
						var tempUtidArray = [];
						mui.each(utidArray, function(index, element) {
							tempUtidArray.push(element.utid);
						});
						strUtid = tempUtidArray.join(',');
					}
					//获取备注
					//35.个人获取对某人或一群人的备注
					//所需参数
					var comData = {
						vvl: strUtid //被备注用户ID,utid或utid串
					};
					postDataPro_PostUmk(comData, wd, function(data) {
						console.log('35_postDataPro_PostUmk_个人获取对某人或一群人的备注.90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							var tempData = utidArray;
							mui.each(data.RspData, function(index, element) {
								mui.each(tempData, function(index2, element2) {
									if(element.butid == element2.utid) {
										var uData = element;
										if(element2.dataType == '3') { //学生
											stu_ugname.value = uData.bunick;
										} else if(element2.dataType == '0') { //家长
											document.getElementById("par_ugname_" + uData.butid).value = uData.bunick;
										} else if(element2.dataType == '2') { //教师
											tea_ugname.value = uData.bunick;
										} else {
											console.log('备注:设置类型出错');
										}
										tempData.splice(index2, 1);
									}
								});
							});
						}
						wd.close();
					});
				}

				/**
				 * 修改学生资料名称
				 * @param {Object} stuName
				 */
				function changeStuName(stuName) {
					if(data.stuimg == null) {
						data.stuimg = 'null';
					}
					var wd = events.showWaiting();
					//23.通过用户资料ID或关联ID更改各类型资料
					//所需参数
					var comData = {
						vtp: 'stu', //更新资料类型,stu:学生,tec:老师,gen:家长关系
						stuid: data.stuid, //资料ID,更新学生老师必填,关系留0
						stuname: stuName, //资料名称
						stuimg: data.stuimg, //资料头像,学生必填,其他留0
						job: '', //职位,老师必填,其他留空
						title: '', //职称,老师必填,其他留空
						expsch: '', //教龄,老师必填,其他留空
						sub: '', //科目,老师必填,其他留空
						ustuid: '', //关联ID,更新与家长关系必填,其他留空
						urel: '', //关系,更新与家长关系必填,其他留空
					};
					var stuid = data.stuid;
					postDataPro_PostReStu(comData, wd, function(data) {
						console.log('90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							mui.toast('修改学生姓名 ' + stuName + ' 成功');
							console.log('修改学生姓名 ' + stuName + ' 成功');
							events.fireToPageNone('qun_manage_data_sub.html', 'changeName', {
								vtp: 'stu', //更新资料类型,stu:学生,tec:老师,gen:家长关系
								stuid: stuid, //资料ID,更新学生老师必填,关系留0
								stuname: stuName, //资料名称
							});
							postNum--;
							if(postNum == 0) {
								mui.back();
							}
							data.stuname = stuName;
						} else {
							mui.toast('修改学生姓名 ' + stuName + ' 失败: ' + data.RspTxt);
							document.getElementById("finish").style.color = 'white';
							change = true;
						}
						wd.close();
					});
				}

				/**
				 * 更新与家长关系
				 * @param {Object} ustuid 关联ID
				 * @param {Object} urel 关系
				 */
				function changeParUrel(ustuid, urel) {
					var wd = events.showWaiting();
					//23.通过用户资料ID或关联ID更改各类型资料
					//所需参数
					var comData = {
						vtp: 'gen', //更新资料类型,stu:学生,tec:老师,gen:家长关系
						stuid: '0', //资料ID,更新学生老师必填,关系留0
						stuname: '0', //资料名称
						stuimg: '0', //资料头像,学生必填,其他留0
						job: '', //职位,老师必填,其他留空
						title: '', //职称,老师必填,其他留空
						expsch: '', //教龄,老师必填,其他留空
						sub: '', //科目,老师必填,其他留空
						ustuid: ustuid, //关联ID,更新与家长关系必填,其他留空
						urel: urel, //关系,更新与家长关系必填,其他留空
					};
					postDataPro_PostReStu(comData, wd, function(data) {
						console.log('90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							mui.toast('更新与家长关系 ' + urel + ' 成功');
							console.log('更新与家长关系 ' + urel + ' 成功');
							postNum--;
							if(postNum == 0) {
								mui.back();
							}

							mui.each(parData, function(index, element) {
								//console.log('更新与家长关系 ' + JSON.stringify(element));
								if(element.ustuid == ustuid) {
									element.urel = urel;
								}
							});
						} else {
							mui.toast('更新与家长关系 ' + urel + ' 失败: ' + data.RspTxt);
							document.getElementById("finish").style.color = 'white';
							change = true;
						}
						wd.close();
					});
				}

				/**
				 * 修改老师资料
				 */
				function changeTea() {
					var wd = events.showWaiting();
					//23.通过用户资料ID或关联ID更改各类型资料
					//所需参数
					var comData = {
						vtp: 'tec', //更新资料类型,stu:学生,tec:老师,gen:家长关系
						stuid: data.stuid, //资料ID,更新学生老师必填,关系留0
						stuname: tea_name.value, //资料名称
						stuimg: '0', //资料头像,学生必填,其他留0
						job: tea_job.value, //职位,老师必填,其他留空
						title: tea_title.value, //职称,老师必填,其他留空
						expsch: tea_expsch.value, //教龄,老师必填,其他留空
						sub: tea_sub.value, //科目,老师必填,其他留空
						ustuid: '', //关联ID,更新与家长关系必填,其他留空
						urel: '', //关系,更新与家长关系必填,其他留空
					};
					var stuid = data.stuid;
					postDataPro_PostReStu(comData, wd, function(data) {
						console.log('90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
						if(data.RspCode == 0) {
							mui.toast('修改老师资料成功');
							console.log('修改老师资料成功');
							events.fireToPageNone('qun_manage_data_sub.html', 'changeName', {
								vtp: 'tec', //更新资料类型,stu:学生,tec:老师,gen:家长关系
								stuid: stuid, //资料ID,更新学生老师必填,关系留0
								stuname: tea_name.value, //资料名称
							});
							mui.back();
						} else {
							mui.toast(data.RspTxt);
							document.getElementById("finish").style.color = 'white';
							change = true;
						}
						wd.close();
					});
				}
			})
		</script>
	</body>

</html>