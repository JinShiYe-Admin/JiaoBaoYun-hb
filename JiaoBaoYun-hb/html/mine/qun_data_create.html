<!--
	作者：444811716@qq.com
	时间：2016-11-24
	描述：创建群资料
-->
<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>创建群资料</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/utils/common.css" rel="stylesheet" />
		<!--<link rel="stylesheet" href="../../css/mui.picker.min.css" />-->
		<!--<link rel="stylesheet" href="../../css/mui.poppicker.css" />-->
		<script src="../../js/mui.min.js"></script>
		<!--<script type="text/javascript" src="../../js/mui.picker.min.js"></script>-->
		<script type="text/javascript" src="../../js/publicProtocol.js"></script>
		<script type="text/javascript" src="../../js/utils/events.js"></script>
		<style>
			body,
			.mui-content {
				background: white;
			}

			.mui-scroll-wrapper {
				margin-top: 95px;
			}

			.mui-content>.mui-table-view:first-child {
				margin-top: 0px
			}

			.mui-table-view:after {
				height: 0px;
			}

			.mui-table-view-cell {
				padding: 5px 15px;
				line-height: 21px;
			}

			.mui-table-view-cell.mui-active {
				background: white;
			}

			.mui-table-view-cell:after {
				left: 0px;
			}

			#type .mui-table-view-cell {
				margin-top: 1px;
			}

			#type {
				border-bottom: 1px solid #dedfe0;
			}

			#type_name {
				height: 40px;
				padding-left: 0px;
				line-height: 40px;
				font-size: 15px;
				color: black;
			}

			#arrowdown {
				line-height: 40px;
			}

			.mui-input-row label {
				width: auto;
				padding: 11px 0px;
				height: 40px;
				line-height: 20px;
				font-size: 16px;
			}

			.mui-input-row label~input {
				width: auto;
				font-size: 15px;
				float: left;
				margin-left: 5px;
			}

			.mui-icon-arrowdown {
				/*margin-left: 5px;*/
				/*float: left;*/
				color: black;
			}

			.mui-bar .mui-icon {
				line-height: 40px;
				padding: 0px;
				margin: 0px;
			}

			.mui-backdrop {
				/*选择排序的遮罩*/
				/*position: fixed;
				top: 0;
				right: 0;
				bottom: 0;
				left: 0;
				z-index: 0;*/
				background-color: transparent;
				/*height: 0px;
				width: 0px;*/
			}

			.mui-popover .mui-popover-arrow:after {
				/*popover的三角形箭头*/
				background-color: white;
				box-shadow: 0 0 5px rgba(0, 0, 0, .1);
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" style="color: white;">创建资料</h1>
			<h1 id="finish" class="mui-title" style="text-align: right;right: 10px;">完成</h1>
		</header>

		<div id="content" class="mui-content">
			<ul id="type" class="mui-table-view">
				<li class="mui-table-view-cell">
					<div class="mui-input-row">
						<label id="type_name_la">身份:</label>
						<a href="#popover" id="type_name">
							<font class="mui-input-row mui-checkbox mui-left">
								<label id="type_name_font"style="padding-left: 40px;">学生</label>
								<input id="type_cb" name="checkbox1" type="checkbox" checked style="top: -7px;left: 1px;">
							</font>
							<div id="arrowdown" class="mui-icon mui-icon-arrowdown"></div>
						</a>
					</div>
				</li>
			</ul>
			<div id="popover" class="mui-popover" style="width: 110px;">
				<div id="popover_arrow" class="mui-popover-arrow"></div>
				<ul class="mui-table-view" style="background: white;text-align: center;">
					<li class="mui-table-view-cell" style="padding-left: 0px;padding-right: 0px;text-align: center;">
						<div class="mui-input-row mui-checkbox mui-left">
							<div id="type_popover" style="line-height: 40px; font-size: 15px;text-align: center;margin-left: 28px;">老师</div>
							<input id="cb_popover" name="Checkbox2" type="checkbox">
						</div>
					</li>
				</ul>
			</div>
			<div id="stu_create" class="mui-scroll-wrapper">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label id="stu_la">学生姓名:</label>
								<input id="stu_name" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
								<div style="position: absolute;right: 0px;top: 13px;color: red;font-size: 24px;">*</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>学生账号:</label>
								<input id="stu_utid" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>学生电话:</label>
								<input type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row ">
								<label>性别:</label>
								<input id="stu_gender" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>所属群:</label>
								<input id="stu_gname" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>简介:</label>
								<input type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
					</ul>
				</div>
			</div>
			<div id="tea_create" class="mui-scroll-wrapper" style="display:none ;">
				<div class="mui-scroll">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>姓名:</label>
								<input id="tea_name" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
								<div style="position: absolute;right: 0px;top: 13px;color: red;font-size: 24px;">*</div>
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>账号:</label>
								<input id="tea_utid" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>昵称:</label>
								<input type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>性别:</label>
								<input id="tea_gender" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>所属群:</label>
								<input id="tea_gname" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职位:</label>
								<input id="tea_job" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>科目:</label>
								<input id="tea_sub" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>职称:</label>
								<input id="tea_title" type="text" class="mui-input-clear" oninput="if(value.length>10)value=value.slice(0,10)">
							</div>
						</li>
						<li class="mui-table-view-cell">
							<div class="mui-input-row">
								<label>教龄:</label>
								<input id="tea_expsch" type="number" oninput="if(value.length>10)value=value.slice(0,10)" class="mui-input-clear">
							</div>
						</li>
						<li class="mui-table-view-cell" style="display: none;">
							<div class="mui-input-row">
								<label>简介:</label>
								<input id="tea_introduction" type="text" class="mui-input-clear" disabled="disabled">
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			mui.init();
			window.onload = function() {
				var header = document.querySelector('header');
				if(header) {
					var headerNum = localStorage.getItem('StatusHeightNo') * 1 + 45;
					//设置顶部导航高度（状态栏）
					header.style.height = headerNum + 'px';
					header.style.paddingTop = localStorage.getItem('$Statusbar');
					//mui.alert(headerNum, 'header-height');
					//mui.alert(localStorage.getItem('StatusbarStr'), 'header-paddingTop');
					var content = document.querySelector(".mui-content");
					//设置顶部导航高度（状态栏）
					if(content) {
						//console.log('window.content');
						content.style.marginTop = localStorage.getItem('$Statusbar');
					}
				}
				//document.getElementById("type").style.top = (localStorage.getItem('StatusHeightNo') * 1 + 45) + 'px';
				document.getElementById("stu_create").style.marginTop = (localStorage.getItem('StatusHeightNo') * 1 + 45 + 53) + 'px';
				document.getElementById("tea_create").style.marginTop = (localStorage.getItem('StatusHeightNo') * 1 + 45 + 53) + 'px';

				var stu_la = document.getElementById("stu_la"); //学生姓名标题
				var stu_name = document.getElementById("stu_name"); //学生姓名输入框
				var stu_gname = document.getElementById("stu_gname"); //所属群输入框
				var type_name_la = document.getElementById("type_name_la") //身份类型左侧标题
				var type_name = document.getElementById("type_name"); //身份类型右侧区域
				var arrowdown = document.getElementById("arrowdown"); //身份类型区域向下箭头
				var popover = document.getElementById("popover"); //popover显示框
				var popover_arrow = document.getElementById("popover_arrow"); //popover显示框的三角区域

				//var type_popover = document.getElementById("type_popover");//popover中的类型
				type_name_la.style.width = stu_la.offsetWidth + 'px';
				type_name.style.width = stu_la.offsetWidth * 2 + 'px';
				type_name.style.marginLeft = stu_name.offsetLeft - type_name.offsetLeft + 'px';
				stu_gname.style.marginLeft = stu_name.offsetLeft - stu_gname.offsetLeft + 5 + 'px';
				arrowdown.style.left = stu_gname.offsetLeft + stu_la.offsetWidth / 1.6 + 'px';

				console.log('type_name_font.offsetLeft ' + document.getElementById("type_name_font").offsetLeft);
				console.log('popover.style.left ' + popover.style.left);
				//popover.style.marginLeft = (arrowdown.offsetLeft + (arrowdown.offsetWidth / 2)) - (popover.offsetLeft) + 'px';

				console.log('arrowdown.offsetLeft ' + arrowdown.offsetLeft);
				console.log('arrowdown.offsetWidth / 2 ' + arrowdown.offsetWidth / 2);
				console.log('popover.offsetLeft ' + popover.offsetLeft);
				//popover.style.marginTop = (localStorage.getItem('StatusHeightNo') * 1 + 45) + 'px';
				//popover_arrow.style.width = '300px';
				//popover_arrow.style.backgroundColor='red';
			}
			mui.plusReady(function() {
				//document.getElementById("type").style.top = (localStorage.getItem('StatusHeightNo') * 1 + 45) + 'px';

				//				var stu_name = document.getElementById("stu_name");
				//				var type_name = document.getElementById("type_name");
				//				var stu_gname = document.getElementById("stu_gname")
				//				type_name.style.marginLeft = stu_name.offsetLeft - type_name.offsetLeft + 5 + 'px';
				//				stu_gname.style.marginLeft = stu_name.offsetLeft - type_name.offsetLeft + 5 + 'px';
				//

				var mstype = 3; //创建的资料类型0家长,2老师,3学生

				//---从父页面获取数据---start---
				var main = plus.webview.currentWebview(); //获取当前窗体对象
				var data = main.data; //接收页面传入的参数值
				//var data = {
				//	gid: gid, //群id
				//	gname: gname, //群名称
				//}
				console.log('从群资料页面获取的数据:' + JSON.stringify(data));
				//---从父页面获取数据---end---

				document.getElementById("stu_gname").value = data.gname;
				document.getElementById("tea_gname").value = data.gname;

				mui('.mui-scroll-wrapper').scroll({
					scrollY: true, //是否竖向滚动
					bounce: true, //是否启用回弹
				});

				document.getElementById('type_popover').addEventListener('tap', function() {
					tapPopover();
				});

				document.getElementById('cb_popover').addEventListener('change', function() {
					document.getElementById("cb_popover").checked = false;
					tapPopover();
				});

				/**
				 * 点击popover的效果
				 */
				function tapPopover() {
					var value = document.getElementById("type_popover").innerText;
					if(value == '老师') {
						document.getElementById("type_popover").innerText = '学生';
						document.getElementById("type_name_font").innerText = '老师';
						document.getElementById("stu_create").style.display = 'none';
						document.getElementById("tea_create").style.display = 'inline';
						mstype = 2;
					} else {
						document.getElementById("type_popover").innerText = '老师';
						document.getElementById("type_name_font").innerText = '学生';
						document.getElementById("stu_create").style.display = 'inline';
						document.getElementById("tea_create").style.display = 'none';
						mstype = 3;
					}
					mui('#popover').popover('toggle');
				}

				//				document.getElementById('type_cb').addEventListener('tap',function () {
				//				        mui('#popover').popover('toggle');
				//				});

				//				document.getElementById('type_name_font').addEventListener('tap',function () {
				//				        mui('#popover').popover('show');
				//				});

				//完成按钮监听
				document.getElementById('finish').addEventListener('tap', function() {
					var name = ''; //姓名
					var job = '0'; //职位，老师用,其他填0
					var title = '0'; //职称，老师用,其他填0
					var expsch = '0'; //教龄，老师用,其他填0
					var sub = '0'; //科目，老师用,其他填0

					if(mstype == 3) { //资料类型0家长,2老师,3学生
						name = document.getElementById("stu_name").value;
					} else if(mstype == 2) {
						name = document.getElementById("tea_name").value;
						job = document.getElementById("tea_job").value;
						title = document.getElementById("tea_title").value;
						expsch = document.getElementById("tea_expsch").value;
						sub = document.getElementById("tea_sub").value;
					}
					if(name.replace(/(^\s*)|(\s*$)/g, "") == "") { //为空不允许发送
						mui.toast('姓名不允许为空');
					} else {
						//15.用户添加资料
						//所需参数
						var comData = {
							gid: data.gid, //群ID
							stuname: name, //资料名
							stuimg: '', //资料头像
							mstype: mstype, //资料类型，0家长,2老师,3学生
							job: job, //职位，老师用,其他填0
							title: title, //职称，老师用,其他填0
							expsch: expsch, //教龄，老师用,其他填0
							sub: sub, //科目，老师用,其他填0
							gutid: '0' //关联的群账号ID，用户在群里的账号ID,无则为0
						};
						console.log('comData:' + JSON.stringify(comData));
						// 等待的对话框
						var wd = events.showWaiting();
						postDataPro_PostGAddUInf(comData, wd, function(data) {

							console.log('90909090success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
							if(data.RspCode == 0) {
								mui.toast('资料添加成功！');
								console.log('资料添加成功！');
								events.fireToPageNone('qun_manage_data_sub.html', 'addData', {
									stuid: data.RspData,
									gid: data.gid,
									stuname: name,
									stuimg: '',
									mstype: mstype
								});
								if(mstype == 3) { //2老师,3学生
									document.getElementById("stu_name").value = '';
								} else {
									console.log('老师');
									document.getElementById("tea_name").value = '';
									document.getElementById("tea_job").value = '';
									document.getElementById("tea_title").value = '';
									document.getElementById("tea_expsch").value = '';
									document.getElementById("tea_sub").value = '';
								}
							} else {
								mui.toast(data.RspTxt);
							}
							wd.close();
						});
					}
				});
			});
		</script>
	</body>

</html>