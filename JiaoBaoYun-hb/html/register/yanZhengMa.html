<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title"></h1>
		</header>
		<div class="mui-content">
			<div id="tishi" style="padding: 30px;text-align: center;">
				<a style="color: black;font-size: 20px;">短信验证码已发送，请填写验证码</a>
			</div>
			<form class="mui-input-group">
				<div class="mui-input-row">
					<label>手机号</label>
					<!--<input type="text" id="phoneNumber" placeholder="请输入手机号" readonly="readonly">-->
					<input type="text" id="phoneNumber" placeholder="请输入手机号">
				</div>
				<div class="mui-input-row">
					<label>验证码</label>
					<input type="text" id="yanzheng" placeholder="请输入验证码">
				</div>
			</form>
			<div class="mui-content-padded">
				<button id='register' class="mui-btn mui-btn-block mui-btn-primary">提交</button>
			</div>
		</div>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<!--界面中用到的事件-->
		<script src="../../js/utils/events.js" type="text/javascript" charset="utf-8"></script>
		<!--本地存储-->
		<script src="../../js/libs/myStorage/myStorage.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/storageKeyName.js" type="text/javascript" charset="utf-8"></script>
		<!--加密-->
		<script src="../../js/libs/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/jQuery.md5.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/MD5.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/RSAEncrypt.js" type="text/javascript" charset="utf-8"></script>
		<!---->
		<script src="js/mui.enterfocus.js" type="text/javascript" charset="utf-8"></script>
		<!--网络请求-->
		<script src="../../js/utils/postData.js" type="text/javascript" charset="utf-8"></script>
		<!--签名-->
		<script src="../../js/libs/crypto-js/require.js"></script>
		<script src="../../js/utils/sortSign.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/utils/signHmacSHA1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				window.addEventListener('yanzhengma', function(event) {
					var temp = event.detail.data;
					console.log('传值的电话号码为：' + JSON.stringify(event.detail));
					var phoneNum = document.getElementById("phoneNumber");
					phoneNum.value = temp;
				});
				var flag = 1;
				events.addTap('register', function() {
					//对账号加密
					var encryptNumb = RSAEncrypt.enctype(document.getElementById("phoneNumber").value);
					//对验证码加密
					var encryptCode = RSAEncrypt.enctype(document.getElementById("yanzheng").value);
					//拼接需要的签名
					var signTemp = sortUrls.sortIt(['uuid=' + plus.device.uuid, 'shaketype=reg', 'appid=' + plus.runtime.appid, 'uid=' + encryptNumb, 'code=' + encryptCode]);
					//生成签名，返回值sign则为签名
					signHmacSHA1.sign(signTemp, 'jsy309', function(sign) {
						//组装发送握手协议需要的data
						var tempData = {
							uuid: plus.device.uuid,
							shaketype: 'reg',
							appid: plus.runtime.appid,
							uid: encryptNumb,
							code: encryptCode,
							sign: sign
						};
						// 等待的对话框
						var wd = plus.nativeUI.showWaiting(storageKeyName.WAITING);
						//判断是注册0，还是验证码模式登录1
						if(flag == 0) { //注册0
							//发送注册协议
							postData(storageKeyName.MAINURL + 'PostReg', tempData, function(data) {
								//成功，关闭等待框
								wd.close();
								console.log('11111success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
								//存储到手机本地
								//							window.myStorage.setItem(window.storageKeyName.SHAKEHAND, data.RspData);
							}, wd);
						} else { //验证码模式登录1
							//发送验证码登录协议
							postData(storageKeyName.MAINURL + 'PostCodeLogin', tempData, function(data) {
								//成功，关闭等待框
								wd.close();
								console.log('11111success:RspCode:' + data.RspCode + ',RspData:' + JSON.stringify(data.RspData) + ',RspTxt:' + data.RspTxt);
								//存储到手机本地
								//							window.myStorage.setItem(window.storageKeyName.SHAKEHAND, data.RspData);
							}, wd);
						}
					});
				});
			});
		</script>
	</body>

</html>