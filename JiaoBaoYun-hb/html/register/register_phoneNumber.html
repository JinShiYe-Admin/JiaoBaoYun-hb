<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title"></h1>
		</header>
		<div class="mui-content">
			<div id="tishi" style="padding: 30px;text-align: center;">
				<a style="color: black;font-size: 20px;">请输入你的手机号</a>
			</div>
			<form class="mui-input-group">
				<div class="mui-input-row">
					<label>手机号</label>
					<input type="text" id="phoneNumber" placeholder="请输入手机号 ">
				</div>
			</form>
			<div class="mui-content-padded">
				<button id='register' class="mui-btn mui-btn-block mui-btn-primary">注册</button>
			</div>
		</div>
		<script src="../../js/mui.min.js" type="text/javascript" charset="utf-8"></script>
		<!--界面中用到的事件-->
		<script src="../../js/utils/events.js" type="text/javascript" charset="utf-8"></script>
		<!--加密-->
		<script src="../../js/libs/RSA/Barrett.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/BigInt.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/jQuery.md5.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/MD5.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<!--本地存储-->
		<script src="../../js/libs/myStorage/myStorage.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../js/libs/crypto-js/require.js" type="text/javascript" charset="utf-8"></script>
		<script src="../knowledge/test.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init();
			mui.plusReady(function() {
				events.preLoad('yanZhengMa.html');
				//签名
				//				require.config({
				//					baseUrl: "",
				//					waitSeconds: 5,
				//					paths: {
				//						"crypto-js": "../../js/libs/crypto-js/crypto-js"
				//					}
				//				});
				//				var temp = 'shaketype=reg&uuid=123423423';
				//				var encrypted;
				//				require(["crypto-js"], function(CryptoJS) {
				//					encrypted = CryptoJS.HmacSHA1(temp, "jsy309").toString(CryptoJS.enc.Base64)
				//					console.log(encrypted);
				//
				//					mui.ajax('http://192.168.0.224:8511/api/CloudApi/PostKeyTest', {
				//						data: {
				//							uuid: '123423423',
				//							shaketype: 'reg',
				//							sign: encrypted
				//						},
				//						dataType: 'json', //服务器返回json格式数据
				//						type: 'post', //HTTP请求类型
				//						timeout: 1000000, //超时时间设置为10秒；
				//						headers: {
				//							'Content-Type': 'application/json'
				//						},
				//						success: function(data) {
				//							//服务器返回响应，根据响应结果，分析是否登录成功；
				//							console.log('data:' + JSON.stringify(data));
				//						},
				//						error: function(xhr, type, errorThrown) {
				//							//异常处理；
				//							console.log(type);
				//						}
				//					});
				//				});

				document.getElementById('register').addEventListener('tap', function() {
					//获取验证码
					var tempValue = window.myStorage.getItem('ShakeHand');
					console.log('秘钥：' + tempValue.Exponent + ',' + tempValue.Modulus);
					//加密电话号码
					setMaxDigits(129);
					var key00 = new RSAKeyPair(tempValue.Exponent, '', tempValue.Modulus);
					var temp11 = encryptedString(key00, document.getElementById("phoneNumber").value);
					console.log('加密后为：' + temp11);
					mui.ajax('http://192.168.0.224:8511/api/CloudApi/GetCode', {
						data: {
							uuid: plus.device.uuid,
							shaketype: 'reg',
							appid: '5',
							uid: temp11
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'get', //HTTP请求类型
						success: function(data) {
							console.log('11111success:RspCode:' + data.RspCode + ',RspData:' + data.RspData + ',RspTxt:' + data.RspTxt);
							
							
							var phoneNum = document.getElementById("phoneNumber");
//							events.addTap('register', function() {
								events.fireToPage('yanZhengMa.html', 'yanzhengma', function() {
									return phoneNum.value;
//								});
							});
						},
						error: function(xhr, type, errorThrown) {
							//异常处理；
							console.log('111111error:' + type);
						}
					});
				});

			});
		</script>
	</body>

</html>